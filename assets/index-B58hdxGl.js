(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function hr(t,e=document){return typeof t=="string"?Array.from(e.querySelectorAll(t)):t instanceof Element?[t]:t instanceof NodeList?Array.from(t):t instanceof Array?t:[]}function yr(t){const e=document.createElement("div");e.className=`scrollama__debug-step ${t}`,e.style.position="fixed",e.style.left="0",e.style.width="100%",e.style.zIndex="9999",e.style.borderTop="2px solid black",e.style.borderBottom="2px solid black";const n=document.createElement("p");return n.style.position="absolute",n.style.left="0",n.style.height="1px",n.style.width="100%",n.style.borderTop="1px dashed black",e.appendChild(n),document.body.appendChild(e),e}function gr({id:t,step:e,marginTop:n}){const{index:r,height:i}=e,o=`scrollama__debug-step--${t}-${r}`;let a=document.querySelector(`.${o}`);a||(a=yr(o)),a.style.top=`${n*-1}px`,a.style.height=`${i}px`,a.querySelector("p").style.top=`${i/2}px`}function mr(){const t="abcdefghijklmnopqrstuvwxyz",e=Date.now(),n=[];for(let r=0;r<6;r+=1){const i=t[Math.floor(Math.random()*t.length)];n.push(i)}return`${n.join("")}${e}`}function Ht(t){console.error(`scrollama error: ${t}`)}function Mt(t){return+t.getAttribute("data-scrollama-index")}function xr(t,e){const n=Math.ceil(t/e),r=[],i=1/n;for(let o=0;o<n+1;o+=1)r.push(o*i);return r}function he(t){if(typeof t=="string"&&t.indexOf("px")>0){const e=+t.replace("px","");return isNaN(e)?(err("offset value must be in 'px' format. Fallback to 0.5."),{format:"percent",value:.5}):{format:"pixels",value:e}}else if(typeof t=="number"||!isNaN(+t))return t>1&&err("offset value is greater than 1. Fallback to 1."),t<0&&err("offset value is lower than 0. Fallback to 0."),{format:"percent",value:Math.min(Math.max(0,t),1)};return null}function vr(t){t.forEach(e=>e.node.setAttribute("data-scrollama-index",e.index))}function br(t){const{top:e}=t.getBoundingClientRect(),n=window.pageYOffset,r=document.body.clientTop||0;return e+n-r}let ft,Vt,Q;function Pn(t){const e=t?t.scrollTop:window.pageYOffset;ft!==e&&(ft=e,ft>Vt?Q="down":ft<Vt&&(Q="up"),Vt=ft)}function wr(t){ft=0,Vt=0,document.addEventListener("scroll",()=>Pn(t))}function _r(){let t={},e=mr(),n=[],r,i,o,a=0,s=!1,c=!1,l=!1,u=!1,p=[];function f(){t={stepEnter:()=>{},stepExit:()=>{},stepProgress:()=>{}},p=[]}function d(k){k&&!s&&N(),!k&&s&&_(),s=k}function x(k,I){const T=Mt(k),R=n[T];I!==void 0&&(R.progress=I);const L={element:k,index:T,progress:I,direction:Q};R.state==="enter"&&t.stepProgress(L)}function h(k,I=!0){const T=Mt(k),R=n[T],L={element:k,index:T,direction:Q};R.direction=Q,R.state="enter",p[T]||t.stepEnter(L),u&&(p[T]=!0)}function y(k,I=!0){const T=Mt(k),R=n[T];if(!R.state)return!1;const L={element:k,index:T,direction:Q};c&&(Q==="down"&&R.progress<1?x(k,1):Q==="up"&&R.progress>0&&x(k,0)),R.direction=Q,R.state="exit",t.stepExit(L)}function v([k]){const I=Mt(k.target),T=n[I],R=k.target.offsetHeight;R!==T.height&&(T.height=R,g(T),E(T),A(T))}function m([k]){Pn(i);const{isIntersecting:I,target:T}=k;I?h(T):y(T)}function b([k]){const I=Mt(k.target),T=n[I],{isIntersecting:R,intersectionRatio:L,target:D}=k;R&&T.state==="enter"&&x(D,L)}function g({observers:k}){Object.keys(k).map(I=>{k[I].disconnect()})}function _(){n.forEach(g)}function A(k){const I=new ResizeObserver(v);I.observe(k.node),k.observers.resize=I}function S(){n.forEach(A)}function E(k){const I=window.innerHeight,T=k.offset||r,R=T.format==="pixels"?1:I,L=T.value*R,D=k.height/2-L,q=k.height/2-(I-L),ut={rootMargin:`${D}px 0px ${q}px 0px`,threshold:.5,root:o},tn=new IntersectionObserver(m,ut);tn.observe(k.node),k.observers.step=tn,l&&gr({id:e,step:k,marginTop:D})}function $(){n.forEach(E)}function C(k){const I=window.innerHeight,T=k.offset||r,R=T.format==="pixels"?1:I,L=T.value*R,D=-L+k.height,q=L-I,tt=`${D}px 0px ${q}px 0px`,At=xr(k.height,a),it={rootMargin:tt,threshold:At},ut=new IntersectionObserver(b,it);ut.observe(k.node),k.observers.progress=ut}function M(){n.forEach(C)}function N(){_(),S(),$(),c&&M()}const w={};return w.setup=({step:k,parent:I,offset:T=.5,threshold:R=4,progress:L=!1,once:D=!1,debug:q=!1,container:tt=void 0,root:At=null})=>(wr(tt),n=hr(k,I).map((it,ut)=>({index:ut,direction:void 0,height:it.offsetHeight,node:it,observers:{},offset:he(it.dataset.offset),top:br(it),progress:0,state:void 0})),n.length?(c=L,u=D,l=q,a=Math.max(1,+R),r=he(T),i=tt,o=At,f(),vr(n),d(!0),w):(Ht("no step elements"),w)),w.enable=()=>(d(!0),w),w.disable=()=>(d(!1),w),w.destroy=()=>(d(!1),f(),w),w.resize=()=>(N(),w),w.offset=k=>k==null?r.value:(r=he(k),N(),w),w.onStepEnter=k=>(typeof k=="function"?t.stepEnter=k:Ht("onStepEnter requires a function"),w),w.onStepExit=k=>(typeof k=="function"?t.stepExit=k:Ht("onStepExit requires a function"),w),w.onStepProgress=k=>(typeof k=="function"?t.stepProgress=k:Ht("onStepProgress requires a function"),w),w}function Ut(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function kr(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function In(t){let e,n,r;t.length!==2?(e=Ut,n=(s,c)=>Ut(t(s),c),r=(s,c)=>t(s)-c):(e=t===Ut||t===kr?t:Ar,n=t,r=t);function i(s,c,l=0,u=s.length){if(l<u){if(e(c,c)!==0)return u;do{const p=l+u>>>1;n(s[p],c)<0?l=p+1:u=p}while(l<u)}return l}function o(s,c,l=0,u=s.length){if(l<u){if(e(c,c)!==0)return u;do{const p=l+u>>>1;n(s[p],c)<=0?l=p+1:u=p}while(l<u)}return l}function a(s,c,l=0,u=s.length){const p=i(s,c,l,u-1);return p>l&&r(s[p-1],c)>-r(s[p],c)?p-1:p}return{left:i,center:a,right:o}}function Ar(){return 0}function Mr(t){return t===null?NaN:+t}const Er=In(Ut),Sr=Er.right;In(Mr).center;const Tr=Math.sqrt(50),$r=Math.sqrt(10),Cr=Math.sqrt(2);function Zt(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),a=o>=Tr?10:o>=$r?5:o>=Cr?2:1;let s,c,l;return i<0?(l=Math.pow(10,-i)/a,s=Math.round(t*l),c=Math.round(e*l),s/l<t&&++s,c/l>e&&--c,l=-l):(l=Math.pow(10,i)*a,s=Math.round(t/l),c=Math.round(e/l),s*l<t&&++s,c*l>e&&--c),c<s&&.5<=n&&n<2?Zt(t,e,n*2):[s,c,l]}function Nr(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,o,a]=r?Zt(e,t,n):Zt(t,e,n);if(!(o>=i))return[];const s=o-i+1,c=new Array(s);if(r)if(a<0)for(let l=0;l<s;++l)c[l]=(o-l)/-a;else for(let l=0;l<s;++l)c[l]=(o-l)*a;else if(a<0)for(let l=0;l<s;++l)c[l]=(i+l)/-a;else for(let l=0;l<s;++l)c[l]=(i+l)*a;return c}function Ae(t,e,n){return e=+e,t=+t,n=+n,Zt(t,e,n)[2]}function Rr(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?Ae(e,t,n):Ae(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function en(t,e){let n;for(const r of t)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);return n}function nn(t,e){let n;for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);return n}function Pr(t){return t}var ye=1,ge=2,Me=3,$t=4,rn=1e-6;function Ir(t){return"translate("+t+",0)"}function zr(t){return"translate(0,"+t+")"}function Lr(t){return e=>+t(e)}function Or(t,e){return e=Math.max(0,t.bandwidth()-e*2)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function Dr(){return!this.__axis}function zn(t,e){var n=[],r=null,i=null,o=6,a=6,s=3,c=typeof window<"u"&&window.devicePixelRatio>1?0:.5,l=t===ye||t===$t?-1:1,u=t===$t||t===ge?"x":"y",p=t===ye||t===Me?Ir:zr;function f(d){var x=r??(e.ticks?e.ticks.apply(e,n):e.domain()),h=i??(e.tickFormat?e.tickFormat.apply(e,n):Pr),y=Math.max(o,0)+s,v=e.range(),m=+v[0]+c,b=+v[v.length-1]+c,g=(e.bandwidth?Or:Lr)(e.copy(),c),_=d.selection?d.selection():d,A=_.selectAll(".domain").data([null]),S=_.selectAll(".tick").data(x,e).order(),E=S.exit(),$=S.enter().append("g").attr("class","tick"),C=S.select("line"),M=S.select("text");A=A.merge(A.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),S=S.merge($),C=C.merge($.append("line").attr("stroke","currentColor").attr(u+"2",l*o)),M=M.merge($.append("text").attr("fill","currentColor").attr(u,l*y).attr("dy",t===ye?"0em":t===Me?"0.71em":"0.32em")),d!==_&&(A=A.transition(d),S=S.transition(d),C=C.transition(d),M=M.transition(d),E=E.transition(d).attr("opacity",rn).attr("transform",function(N){return isFinite(N=g(N))?p(N+c):this.getAttribute("transform")}),$.attr("opacity",rn).attr("transform",function(N){var w=this.parentNode.__axis;return p((w&&isFinite(w=w(N))?w:g(N))+c)})),E.remove(),A.attr("d",t===$t||t===ge?a?"M"+l*a+","+m+"H"+c+"V"+b+"H"+l*a:"M"+c+","+m+"V"+b:a?"M"+m+","+l*a+"V"+c+"H"+b+"V"+l*a:"M"+m+","+c+"H"+b),S.attr("opacity",1).attr("transform",function(N){return p(g(N)+c)}),C.attr(u+"2",l*o),M.attr(u,l*y).text(h),_.filter(Dr).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===ge?"start":t===$t?"end":"middle"),_.each(function(){this.__axis=g})}return f.scale=function(d){return arguments.length?(e=d,f):e},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(d){return arguments.length?(n=d==null?[]:Array.from(d),f):n.slice()},f.tickValues=function(d){return arguments.length?(r=d==null?null:Array.from(d),f):r&&r.slice()},f.tickFormat=function(d){return arguments.length?(i=d,f):i},f.tickSize=function(d){return arguments.length?(o=a=+d,f):o},f.tickSizeInner=function(d){return arguments.length?(o=+d,f):o},f.tickSizeOuter=function(d){return arguments.length?(a=+d,f):a},f.tickPadding=function(d){return arguments.length?(s=+d,f):s},f.offset=function(d){return arguments.length?(c=+d,f):c},f}function Ln(t){return zn(Me,t)}function On(t){return zn($t,t)}var Yr={value:()=>{}};function ce(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Wt(n)}function Wt(t){this._=t}function Hr(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Wt.prototype=ce.prototype={constructor:Wt,on:function(t,e){var n=this._,r=Hr(t+"",n),i,o=-1,a=r.length;if(arguments.length<2){for(;++o<a;)if((i=(t=r[o]).type)&&(i=Fr(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<a;)if(i=(t=r[o]).type)n[i]=on(n[i],t.name,e);else if(e==null)for(i in n)n[i]=on(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Wt(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,o;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};function Fr(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function on(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Yr,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Ee="http://www.w3.org/1999/xhtml";const an={svg:"http://www.w3.org/2000/svg",xhtml:Ee,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ue(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),an.hasOwnProperty(e)?{space:an[e],local:t}:t}function Xr(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Ee&&e.documentElement.namespaceURI===Ee?e.createElement(t):e.createElementNS(n,t)}}function qr(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Dn(t){var e=ue(t);return(e.local?qr:Xr)(e)}function Br(){}function Le(t){return t==null?Br:function(){return this.querySelector(t)}}function Gr(t){typeof t!="function"&&(t=Le(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],a=o.length,s=r[i]=new Array(a),c,l,u=0;u<a;++u)(c=o[u])&&(l=t.call(c,c.__data__,u,o))&&("__data__"in c&&(l.__data__=c.__data__),s[u]=l);return new H(r,this._parents)}function Yn(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Vr(){return[]}function Hn(t){return t==null?Vr:function(){return this.querySelectorAll(t)}}function Ur(t){return function(){return Yn(t.apply(this,arguments))}}function Wr(t){typeof t=="function"?t=Ur(t):t=Hn(t);for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a=e[o],s=a.length,c,l=0;l<s;++l)(c=a[l])&&(r.push(t.call(c,c.__data__,l,a)),i.push(c));return new H(r,i)}function Fn(t){return function(){return this.matches(t)}}function Xn(t){return function(e){return e.matches(t)}}var Kr=Array.prototype.find;function Qr(t){return function(){return Kr.call(this.children,t)}}function Zr(){return this.firstElementChild}function Jr(t){return this.select(t==null?Zr:Qr(typeof t=="function"?t:Xn(t)))}var jr=Array.prototype.filter;function ti(){return Array.from(this.children)}function ei(t){return function(){return jr.call(this.children,t)}}function ni(t){return this.selectAll(t==null?ti:ei(typeof t=="function"?t:Xn(t)))}function ri(t){typeof t!="function"&&(t=Fn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],a=o.length,s=r[i]=[],c,l=0;l<a;++l)(c=o[l])&&t.call(c,c.__data__,l,o)&&s.push(c);return new H(r,this._parents)}function qn(t){return new Array(t.length)}function ii(){return new H(this._enter||this._groups.map(qn),this._parents)}function Jt(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Jt.prototype={constructor:Jt,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function oi(t){return function(){return t}}function ai(t,e,n,r,i,o){for(var a=0,s,c=e.length,l=o.length;a<l;++a)(s=e[a])?(s.__data__=o[a],r[a]=s):n[a]=new Jt(t,o[a]);for(;a<c;++a)(s=e[a])&&(i[a]=s)}function si(t,e,n,r,i,o,a){var s,c,l=new Map,u=e.length,p=o.length,f=new Array(u),d;for(s=0;s<u;++s)(c=e[s])&&(f[s]=d=a.call(c,c.__data__,s,e)+"",l.has(d)?i[s]=c:l.set(d,c));for(s=0;s<p;++s)d=a.call(t,o[s],s,o)+"",(c=l.get(d))?(r[s]=c,c.__data__=o[s],l.delete(d)):n[s]=new Jt(t,o[s]);for(s=0;s<u;++s)(c=e[s])&&l.get(f[s])===c&&(i[s]=c)}function li(t){return t.__data__}function ci(t,e){if(!arguments.length)return Array.from(this,li);var n=e?si:ai,r=this._parents,i=this._groups;typeof t!="function"&&(t=oi(t));for(var o=i.length,a=new Array(o),s=new Array(o),c=new Array(o),l=0;l<o;++l){var u=r[l],p=i[l],f=p.length,d=ui(t.call(u,u&&u.__data__,l,r)),x=d.length,h=s[l]=new Array(x),y=a[l]=new Array(x),v=c[l]=new Array(f);n(u,p,h,y,v,d,e);for(var m=0,b=0,g,_;m<x;++m)if(g=h[m]){for(m>=b&&(b=m+1);!(_=y[b])&&++b<x;);g._next=_||null}}return a=new H(a,r),a._enter=s,a._exit=c,a}function ui(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function fi(){return new H(this._exit||this._groups.map(qn),this._parents)}function di(t,e,n){var r=this.enter(),i=this,o=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?o.remove():n(o),r&&i?r.merge(i).order():i}function pi(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,a=Math.min(i,o),s=new Array(i),c=0;c<a;++c)for(var l=n[c],u=r[c],p=l.length,f=s[c]=new Array(p),d,x=0;x<p;++x)(d=l[x]||u[x])&&(f[x]=d);for(;c<i;++c)s[c]=n[c];return new H(s,this._parents)}function hi(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,o=r[i],a;--i>=0;)(a=r[i])&&(o&&a.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(a,o),o=a);return this}function yi(t){t||(t=gi);function e(p,f){return p&&f?t(p.__data__,f.__data__):!p-!f}for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a=n[o],s=a.length,c=i[o]=new Array(s),l,u=0;u<s;++u)(l=a[u])&&(c[u]=l);c.sort(e)}return new H(i,this._parents).order()}function gi(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function mi(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function xi(){return Array.from(this)}function vi(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null}function bi(){let t=0;for(const e of this)++t;return t}function wi(){return!this.node()}function _i(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],o=0,a=i.length,s;o<a;++o)(s=i[o])&&t.call(s,s.__data__,o,i);return this}function ki(t){return function(){this.removeAttribute(t)}}function Ai(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Mi(t,e){return function(){this.setAttribute(t,e)}}function Ei(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Si(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Ti(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function $i(t,e){var n=ue(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?Ai:ki:typeof e=="function"?n.local?Ti:Si:n.local?Ei:Mi)(n,e))}function Bn(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Ci(t){return function(){this.style.removeProperty(t)}}function Ni(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Ri(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Pi(t,e,n){return arguments.length>1?this.each((e==null?Ci:typeof e=="function"?Ri:Ni)(t,e,n??"")):vt(this.node(),t)}function vt(t,e){return t.style.getPropertyValue(e)||Bn(t).getComputedStyle(t,null).getPropertyValue(e)}function Ii(t){return function(){delete this[t]}}function zi(t,e){return function(){this[t]=e}}function Li(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Oi(t,e){return arguments.length>1?this.each((e==null?Ii:typeof e=="function"?Li:zi)(t,e)):this.node()[t]}function Gn(t){return t.trim().split(/^|\s+/)}function Oe(t){return t.classList||new Vn(t)}function Vn(t){this._node=t,this._names=Gn(t.getAttribute("class")||"")}Vn.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Un(t,e){for(var n=Oe(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Wn(t,e){for(var n=Oe(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function Di(t){return function(){Un(this,t)}}function Yi(t){return function(){Wn(this,t)}}function Hi(t,e){return function(){(e.apply(this,arguments)?Un:Wn)(this,t)}}function Fi(t,e){var n=Gn(t+"");if(arguments.length<2){for(var r=Oe(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?Hi:e?Di:Yi)(n,e))}function Xi(){this.textContent=""}function qi(t){return function(){this.textContent=t}}function Bi(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Gi(t){return arguments.length?this.each(t==null?Xi:(typeof t=="function"?Bi:qi)(t)):this.node().textContent}function Vi(){this.innerHTML=""}function Ui(t){return function(){this.innerHTML=t}}function Wi(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Ki(t){return arguments.length?this.each(t==null?Vi:(typeof t=="function"?Wi:Ui)(t)):this.node().innerHTML}function Qi(){this.nextSibling&&this.parentNode.appendChild(this)}function Zi(){return this.each(Qi)}function Ji(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ji(){return this.each(Ji)}function to(t){var e=typeof t=="function"?t:Dn(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function eo(){return null}function no(t,e){var n=typeof t=="function"?t:Dn(t),r=e==null?eo:typeof e=="function"?e:Le(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function ro(){var t=this.parentNode;t&&t.removeChild(this)}function io(){return this.each(ro)}function oo(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ao(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function so(t){return this.select(t?ao:oo)}function lo(t){return arguments.length?this.property("__data__",t):this.node().__data__}function co(t){return function(e){t.call(this,e,this.__data__)}}function uo(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function fo(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,o;n<i;++n)o=e[n],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function po(t,e,n){return function(){var r=this.__on,i,o=co(e);if(r){for(var a=0,s=r.length;a<s;++a)if((i=r[a]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),i.value=e;return}}this.addEventListener(t.type,o,n),i={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(i):this.__on=[i]}}function ho(t,e,n){var r=uo(t+""),i,o=r.length,a;if(arguments.length<2){var s=this.node().__on;if(s){for(var c=0,l=s.length,u;c<l;++c)for(i=0,u=s[c];i<o;++i)if((a=r[i]).type===u.type&&a.name===u.name)return u.value}return}for(s=e?po:fo,i=0;i<o;++i)this.each(s(r[i],e,n));return this}function Kn(t,e,n){var r=Bn(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function yo(t,e){return function(){return Kn(this,t,e)}}function go(t,e){return function(){return Kn(this,t,e.apply(this,arguments))}}function mo(t,e){return this.each((typeof e=="function"?go:yo)(t,e))}function*xo(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length,a;i<o;++i)(a=r[i])&&(yield a)}var De=[null];function H(t,e){this._groups=t,this._parents=e}function Dt(){return new H([[document.documentElement]],De)}function vo(){return this}H.prototype=Dt.prototype={constructor:H,select:Gr,selectAll:Wr,selectChild:Jr,selectChildren:ni,filter:ri,data:ci,enter:ii,exit:fi,join:di,merge:pi,selection:vo,order:hi,sort:yi,call:mi,nodes:xi,node:vi,size:bi,empty:wi,each:_i,attr:$i,style:Pi,property:Oi,classed:Fi,text:Gi,html:Ki,raise:Zi,lower:ji,append:to,insert:no,remove:io,clone:so,datum:lo,on:ho,dispatch:mo,[Symbol.iterator]:xo};function P(t){return typeof t=="string"?new H([[document.querySelector(t)]],[document.documentElement]):new H([[t]],De)}function bo(t){let e;for(;e=t.sourceEvent;)t=e;return t}function sn(t,e){if(t=bo(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}function bt(t){return typeof t=="string"?new H([document.querySelectorAll(t)],[document.documentElement]):new H([Yn(t)],De)}const wo={passive:!1},Pt={capture:!0,passive:!1};function me(t){t.stopImmediatePropagation()}function yt(t){t.preventDefault(),t.stopImmediatePropagation()}function _o(t){var e=t.document.documentElement,n=P(t).on("dragstart.drag",yt,Pt);"onselectstart"in e?n.on("selectstart.drag",yt,Pt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function ko(t,e){var n=t.document.documentElement,r=P(t).on("dragstart.drag",null);e&&(r.on("click.drag",yt,Pt),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const Ft=t=>()=>t;function Se(t,{sourceEvent:e,subject:n,target:r,identifier:i,active:o,x:a,y:s,dx:c,dy:l,dispatch:u}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:a,enumerable:!0,configurable:!0},y:{value:s,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:l,enumerable:!0,configurable:!0},_:{value:u}})}Se.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function Ao(t){return!t.ctrlKey&&!t.button}function Mo(){return this.parentNode}function Eo(t,e){return e??{x:t.x,y:t.y}}function So(){return navigator.maxTouchPoints||"ontouchstart"in this}function To(){var t=Ao,e=Mo,n=Eo,r=So,i={},o=ce("start","drag","end"),a=0,s,c,l,u,p=0;function f(g){g.on("mousedown.drag",d).filter(r).on("touchstart.drag",y).on("touchmove.drag",v,wo).on("touchend.drag touchcancel.drag",m).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function d(g,_){if(!(u||!t.call(this,g,_))){var A=b(this,e.call(this,g,_),g,_,"mouse");A&&(P(g.view).on("mousemove.drag",x,Pt).on("mouseup.drag",h,Pt),_o(g.view),me(g),l=!1,s=g.clientX,c=g.clientY,A("start",g))}}function x(g){if(yt(g),!l){var _=g.clientX-s,A=g.clientY-c;l=_*_+A*A>p}i.mouse("drag",g)}function h(g){P(g.view).on("mousemove.drag mouseup.drag",null),ko(g.view,l),yt(g),i.mouse("end",g)}function y(g,_){if(t.call(this,g,_)){var A=g.changedTouches,S=e.call(this,g,_),E=A.length,$,C;for($=0;$<E;++$)(C=b(this,S,g,_,A[$].identifier,A[$]))&&(me(g),C("start",g,A[$]))}}function v(g){var _=g.changedTouches,A=_.length,S,E;for(S=0;S<A;++S)(E=i[_[S].identifier])&&(yt(g),E("drag",g,_[S]))}function m(g){var _=g.changedTouches,A=_.length,S,E;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),S=0;S<A;++S)(E=i[_[S].identifier])&&(me(g),E("end",g,_[S]))}function b(g,_,A,S,E,$){var C=o.copy(),M=sn($||A,_),N,w,k;if((k=n.call(g,new Se("beforestart",{sourceEvent:A,target:f,identifier:E,active:a,x:M[0],y:M[1],dx:0,dy:0,dispatch:C}),S))!=null)return N=k.x-M[0]||0,w=k.y-M[1]||0,function I(T,R,L){var D=M,q;switch(T){case"start":i[E]=I,q=a++;break;case"end":delete i[E],--a;case"drag":M=sn(L||R,_),q=a;break}C.call(T,g,new Se(T,{sourceEvent:R,subject:k,target:f,identifier:E,active:q,x:M[0]+N,y:M[1]+w,dx:M[0]-D[0],dy:M[1]-D[1],dispatch:C}),S)}}return f.filter=function(g){return arguments.length?(t=typeof g=="function"?g:Ft(!!g),f):t},f.container=function(g){return arguments.length?(e=typeof g=="function"?g:Ft(g),f):e},f.subject=function(g){return arguments.length?(n=typeof g=="function"?g:Ft(g),f):n},f.touchable=function(g){return arguments.length?(r=typeof g=="function"?g:Ft(!!g),f):r},f.on=function(){var g=o.on.apply(o,arguments);return g===o?f:g},f.clickDistance=function(g){return arguments.length?(p=(g=+g)*g,f):Math.sqrt(p)},f}function Ye(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Qn(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Yt(){}var It=.7,jt=1/It,gt="\\s*([+-]?\\d+)\\s*",zt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",U="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",$o=/^#([0-9a-f]{3,8})$/,Co=new RegExp(`^rgb\\(${gt},${gt},${gt}\\)$`),No=new RegExp(`^rgb\\(${U},${U},${U}\\)$`),Ro=new RegExp(`^rgba\\(${gt},${gt},${gt},${zt}\\)$`),Po=new RegExp(`^rgba\\(${U},${U},${U},${zt}\\)$`),Io=new RegExp(`^hsl\\(${zt},${U},${U}\\)$`),zo=new RegExp(`^hsla\\(${zt},${U},${U},${zt}\\)$`),ln={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ye(Yt,lt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:cn,formatHex:cn,formatHex8:Lo,formatHsl:Oo,formatRgb:un,toString:un});function cn(){return this.rgb().formatHex()}function Lo(){return this.rgb().formatHex8()}function Oo(){return Zn(this).formatHsl()}function un(){return this.rgb().formatRgb()}function lt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=$o.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?fn(e):n===3?new X(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Xt(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Xt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Co.exec(t))?new X(e[1],e[2],e[3],1):(e=No.exec(t))?new X(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Ro.exec(t))?Xt(e[1],e[2],e[3],e[4]):(e=Po.exec(t))?Xt(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Io.exec(t))?hn(e[1],e[2]/100,e[3]/100,1):(e=zo.exec(t))?hn(e[1],e[2]/100,e[3]/100,e[4]):ln.hasOwnProperty(t)?fn(ln[t]):t==="transparent"?new X(NaN,NaN,NaN,0):null}function fn(t){return new X(t>>16&255,t>>8&255,t&255,1)}function Xt(t,e,n,r){return r<=0&&(t=e=n=NaN),new X(t,e,n,r)}function Do(t){return t instanceof Yt||(t=lt(t)),t?(t=t.rgb(),new X(t.r,t.g,t.b,t.opacity)):new X}function Te(t,e,n,r){return arguments.length===1?Do(t):new X(t,e,n,r??1)}function X(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Ye(X,Te,Qn(Yt,{brighter(t){return t=t==null?jt:Math.pow(jt,t),new X(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?It:Math.pow(It,t),new X(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new X(at(this.r),at(this.g),at(this.b),te(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:dn,formatHex:dn,formatHex8:Yo,formatRgb:pn,toString:pn}));function dn(){return`#${ot(this.r)}${ot(this.g)}${ot(this.b)}`}function Yo(){return`#${ot(this.r)}${ot(this.g)}${ot(this.b)}${ot((isNaN(this.opacity)?1:this.opacity)*255)}`}function pn(){const t=te(this.opacity);return`${t===1?"rgb(":"rgba("}${at(this.r)}, ${at(this.g)}, ${at(this.b)}${t===1?")":`, ${t})`}`}function te(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function at(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ot(t){return t=at(t),(t<16?"0":"")+t.toString(16)}function hn(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new G(t,e,n,r)}function Zn(t){if(t instanceof G)return new G(t.h,t.s,t.l,t.opacity);if(t instanceof Yt||(t=lt(t)),!t)return new G;if(t instanceof G)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,c=(o+i)/2;return s?(e===o?a=(n-r)/s+(n<r)*6:n===o?a=(r-e)/s+2:a=(e-n)/s+4,s/=c<.5?o+i:2-o-i,a*=60):s=c>0&&c<1?0:a,new G(a,s,c,t.opacity)}function Ho(t,e,n,r){return arguments.length===1?Zn(t):new G(t,e,n,r??1)}function G(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Ye(G,Ho,Qn(Yt,{brighter(t){return t=t==null?jt:Math.pow(jt,t),new G(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?It:Math.pow(It,t),new G(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new X(xe(t>=240?t-240:t+120,i,r),xe(t,i,r),xe(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new G(yn(this.h),qt(this.s),qt(this.l),te(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=te(this.opacity);return`${t===1?"hsl(":"hsla("}${yn(this.h)}, ${qt(this.s)*100}%, ${qt(this.l)*100}%${t===1?")":`, ${t})`}`}}));function yn(t){return t=(t||0)%360,t<0?t+360:t}function qt(t){return Math.max(0,Math.min(1,t||0))}function xe(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const He=t=>()=>t;function Fo(t,e){return function(n){return t+n*e}}function Xo(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function qo(t){return(t=+t)==1?Jn:function(e,n){return n-e?Xo(e,n,t):He(isNaN(e)?n:e)}}function Jn(t,e){var n=e-t;return n?Fo(t,n):He(isNaN(t)?e:t)}const ee=function t(e){var n=qo(e);function r(i,o){var a=n((i=Te(i)).r,(o=Te(o)).r),s=n(i.g,o.g),c=n(i.b,o.b),l=Jn(i.opacity,o.opacity);return function(u){return i.r=a(u),i.g=s(u),i.b=c(u),i.opacity=l(u),i+""}}return r.gamma=t,r}(1);function Bo(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(o){for(i=0;i<n;++i)r[i]=t[i]*(1-o)+e[i]*o;return r}}function Go(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Vo(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),o=new Array(n),a;for(a=0;a<r;++a)i[a]=Fe(t[a],e[a]);for(;a<n;++a)o[a]=e[a];return function(s){for(a=0;a<r;++a)o[a]=i[a](s);return o}}function Uo(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function B(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Wo(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=Fe(t[i],e[i]):r[i]=e[i];return function(o){for(i in n)r[i]=n[i](o);return r}}var $e=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ve=new RegExp($e.source,"g");function Ko(t){return function(){return t}}function Qo(t){return function(e){return t(e)+""}}function jn(t,e){var n=$e.lastIndex=ve.lastIndex=0,r,i,o,a=-1,s=[],c=[];for(t=t+"",e=e+"";(r=$e.exec(t))&&(i=ve.exec(e));)(o=i.index)>n&&(o=e.slice(n,o),s[a]?s[a]+=o:s[++a]=o),(r=r[0])===(i=i[0])?s[a]?s[a]+=i:s[++a]=i:(s[++a]=null,c.push({i:a,x:B(r,i)})),n=ve.lastIndex;return n<e.length&&(o=e.slice(n),s[a]?s[a]+=o:s[++a]=o),s.length<2?c[0]?Qo(c[0].x):Ko(e):(e=c.length,function(l){for(var u=0,p;u<e;++u)s[(p=c[u]).i]=p.x(l);return s.join("")})}function Fe(t,e){var n=typeof e,r;return e==null||n==="boolean"?He(e):(n==="number"?B:n==="string"?(r=lt(e))?(e=r,ee):jn:e instanceof lt?ee:e instanceof Date?Uo:Go(e)?Bo:Array.isArray(e)?Vo:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Wo:B)(t,e)}function Zo(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var gn=180/Math.PI,Ce={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function tr(t,e,n,r,i,o){var a,s,c;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(c=t*n+e*r)&&(n-=t*c,r-=e*c),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,c/=s),t*r<e*n&&(t=-t,e=-e,c=-c,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*gn,skewX:Math.atan(c)*gn,scaleX:a,scaleY:s}}var Bt;function Jo(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Ce:tr(e.a,e.b,e.c,e.d,e.e,e.f)}function jo(t){return t==null||(Bt||(Bt=document.createElementNS("http://www.w3.org/2000/svg","g")),Bt.setAttribute("transform",t),!(t=Bt.transform.baseVal.consolidate()))?Ce:(t=t.matrix,tr(t.a,t.b,t.c,t.d,t.e,t.f))}function er(t,e,n,r){function i(l){return l.length?l.pop()+" ":""}function o(l,u,p,f,d,x){if(l!==p||u!==f){var h=d.push("translate(",null,e,null,n);x.push({i:h-4,x:B(l,p)},{i:h-2,x:B(u,f)})}else(p||f)&&d.push("translate("+p+e+f+n)}function a(l,u,p,f){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),f.push({i:p.push(i(p)+"rotate(",null,r)-2,x:B(l,u)})):u&&p.push(i(p)+"rotate("+u+r)}function s(l,u,p,f){l!==u?f.push({i:p.push(i(p)+"skewX(",null,r)-2,x:B(l,u)}):u&&p.push(i(p)+"skewX("+u+r)}function c(l,u,p,f,d,x){if(l!==p||u!==f){var h=d.push(i(d)+"scale(",null,",",null,")");x.push({i:h-4,x:B(l,p)},{i:h-2,x:B(u,f)})}else(p!==1||f!==1)&&d.push(i(d)+"scale("+p+","+f+")")}return function(l,u){var p=[],f=[];return l=t(l),u=t(u),o(l.translateX,l.translateY,u.translateX,u.translateY,p,f),a(l.rotate,u.rotate,p,f),s(l.skewX,u.skewX,p,f),c(l.scaleX,l.scaleY,u.scaleX,u.scaleY,p,f),l=u=null,function(d){for(var x=-1,h=f.length,y;++x<h;)p[(y=f[x]).i]=y.x(d);return p.join("")}}}var ta=er(Jo,"px, ","px)","deg)"),ea=er(jo,", ",")",")"),wt=0,Ct=0,Et=0,nr=1e3,ne,Nt,re=0,ct=0,fe=0,Lt=typeof performance=="object"&&performance.now?performance:Date,rr=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Xe(){return ct||(rr(na),ct=Lt.now()+fe)}function na(){ct=0}function ie(){this._call=this._time=this._next=null}ie.prototype=qe.prototype={constructor:ie,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Xe():+n)+(e==null?0:+e),!this._next&&Nt!==this&&(Nt?Nt._next=this:ne=this,Nt=this),this._call=t,this._time=n,Ne()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ne())}};function qe(t,e,n){var r=new ie;return r.restart(t,e,n),r}function ra(){Xe(),++wt;for(var t=ne,e;t;)(e=ct-t._time)>=0&&t._call.call(void 0,e),t=t._next;--wt}function mn(){ct=(re=Lt.now())+fe,wt=Ct=0;try{ra()}finally{wt=0,oa(),ct=0}}function ia(){var t=Lt.now(),e=t-re;e>nr&&(fe-=e,re=t)}function oa(){for(var t,e=ne,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:ne=n);Nt=t,Ne(r)}function Ne(t){if(!wt){Ct&&(Ct=clearTimeout(Ct));var e=t-ct;e>24?(t<1/0&&(Ct=setTimeout(mn,t-Lt.now()-fe)),Et&&(Et=clearInterval(Et))):(Et||(re=Lt.now(),Et=setInterval(ia,nr)),wt=1,rr(mn))}}function xn(t,e,n){var r=new ie;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var aa=ce("start","end","cancel","interrupt"),sa=[],ir=0,vn=1,Re=2,Kt=3,bn=4,Pe=5,Qt=6;function de(t,e,n,r,i,o){var a=t.__transition;if(!a)t.__transition={};else if(n in a)return;la(t,n,{name:e,index:r,group:i,on:aa,tween:sa,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:ir})}function Be(t,e){var n=V(t,e);if(n.state>ir)throw new Error("too late; already scheduled");return n}function W(t,e){var n=V(t,e);if(n.state>Kt)throw new Error("too late; already running");return n}function V(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function la(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=qe(o,0,n.time);function o(l){n.state=vn,n.timer.restart(a,n.delay,n.time),n.delay<=l&&a(l-n.delay)}function a(l){var u,p,f,d;if(n.state!==vn)return c();for(u in r)if(d=r[u],d.name===n.name){if(d.state===Kt)return xn(a);d.state===bn?(d.state=Qt,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[u]):+u<e&&(d.state=Qt,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[u])}if(xn(function(){n.state===Kt&&(n.state=bn,n.timer.restart(s,n.delay,n.time),s(l))}),n.state=Re,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Re){for(n.state=Kt,i=new Array(f=n.tween.length),u=0,p=-1;u<f;++u)(d=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(i[++p]=d);i.length=p+1}}function s(l){for(var u=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(c),n.state=Pe,1),p=-1,f=i.length;++p<f;)i[p].call(t,u);n.state===Pe&&(n.on.call("end",t,t.__data__,n.index,n.group),c())}function c(){n.state=Qt,n.timer.stop(),delete r[e];for(var l in r)return;delete t.__transition}}function ca(t,e){var n=t.__transition,r,i,o=!0,a;if(n){e=e==null?null:e+"";for(a in n){if((r=n[a]).name!==e){o=!1;continue}i=r.state>Re&&r.state<Pe,r.state=Qt,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[a]}o&&delete t.__transition}}function ua(t){return this.each(function(){ca(this,t)})}function fa(t,e){var n,r;return function(){var i=W(this,t),o=i.tween;if(o!==n){r=n=o;for(var a=0,s=r.length;a<s;++a)if(r[a].name===e){r=r.slice(),r.splice(a,1);break}}i.tween=r}}function da(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var o=W(this,t),a=o.tween;if(a!==r){i=(r=a).slice();for(var s={name:e,value:n},c=0,l=i.length;c<l;++c)if(i[c].name===e){i[c]=s;break}c===l&&i.push(s)}o.tween=i}}function pa(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=V(this.node(),n).tween,i=0,o=r.length,a;i<o;++i)if((a=r[i]).name===t)return a.value;return null}return this.each((e==null?fa:da)(n,t,e))}function Ge(t,e,n){var r=t._id;return t.each(function(){var i=W(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return V(i,r).value[e]}}function or(t,e){var n;return(typeof e=="number"?B:e instanceof lt?ee:(n=lt(e))?(e=n,ee):jn)(t,e)}function ha(t){return function(){this.removeAttribute(t)}}function ya(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ga(t,e,n){var r,i=n+"",o;return function(){var a=this.getAttribute(t);return a===i?null:a===r?o:o=e(r=a,n)}}function ma(t,e,n){var r,i=n+"",o;return function(){var a=this.getAttributeNS(t.space,t.local);return a===i?null:a===r?o:o=e(r=a,n)}}function xa(t,e,n){var r,i,o;return function(){var a,s=n(this),c;return s==null?void this.removeAttribute(t):(a=this.getAttribute(t),c=s+"",a===c?null:a===r&&c===i?o:(i=c,o=e(r=a,s)))}}function va(t,e,n){var r,i,o;return function(){var a,s=n(this),c;return s==null?void this.removeAttributeNS(t.space,t.local):(a=this.getAttributeNS(t.space,t.local),c=s+"",a===c?null:a===r&&c===i?o:(i=c,o=e(r=a,s)))}}function ba(t,e){var n=ue(t),r=n==="transform"?ea:or;return this.attrTween(t,typeof e=="function"?(n.local?va:xa)(n,r,Ge(this,"attr."+t,e)):e==null?(n.local?ya:ha)(n):(n.local?ma:ga)(n,r,e))}function wa(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function _a(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function ka(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&_a(t,o)),n}return i._value=e,i}function Aa(t,e){var n,r;function i(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&wa(t,o)),n}return i._value=e,i}function Ma(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=ue(t);return this.tween(n,(r.local?ka:Aa)(r,e))}function Ea(t,e){return function(){Be(this,t).delay=+e.apply(this,arguments)}}function Sa(t,e){return e=+e,function(){Be(this,t).delay=e}}function Ta(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Ea:Sa)(e,t)):V(this.node(),e).delay}function $a(t,e){return function(){W(this,t).duration=+e.apply(this,arguments)}}function Ca(t,e){return e=+e,function(){W(this,t).duration=e}}function Na(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?$a:Ca)(e,t)):V(this.node(),e).duration}function Ra(t,e){if(typeof e!="function")throw new Error;return function(){W(this,t).ease=e}}function Pa(t){var e=this._id;return arguments.length?this.each(Ra(e,t)):V(this.node(),e).ease}function Ia(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;W(this,t).ease=n}}function za(t){if(typeof t!="function")throw new Error;return this.each(Ia(this._id,t))}function La(t){typeof t!="function"&&(t=Fn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o=e[i],a=o.length,s=r[i]=[],c,l=0;l<a;++l)(c=o[l])&&t.call(c,c.__data__,l,o)&&s.push(c);return new j(r,this._parents,this._name,this._id)}function Oa(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),s=0;s<o;++s)for(var c=e[s],l=n[s],u=c.length,p=a[s]=new Array(u),f,d=0;d<u;++d)(f=c[d]||l[d])&&(p[d]=f);for(;s<r;++s)a[s]=e[s];return new j(a,this._parents,this._name,this._id)}function Da(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Ya(t,e,n){var r,i,o=Da(e)?Be:W;return function(){var a=o(this,t),s=a.on;s!==r&&(i=(r=s).copy()).on(e,n),a.on=i}}function Ha(t,e){var n=this._id;return arguments.length<2?V(this.node(),n).on.on(t):this.each(Ya(n,t,e))}function Fa(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Xa(){return this.on("end.remove",Fa(this._id))}function qa(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Le(t));for(var r=this._groups,i=r.length,o=new Array(i),a=0;a<i;++a)for(var s=r[a],c=s.length,l=o[a]=new Array(c),u,p,f=0;f<c;++f)(u=s[f])&&(p=t.call(u,u.__data__,f,s))&&("__data__"in u&&(p.__data__=u.__data__),l[f]=p,de(l[f],e,n,f,l,V(u,n)));return new j(o,this._parents,e,n)}function Ba(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Hn(t));for(var r=this._groups,i=r.length,o=[],a=[],s=0;s<i;++s)for(var c=r[s],l=c.length,u,p=0;p<l;++p)if(u=c[p]){for(var f=t.call(u,u.__data__,p,c),d,x=V(u,n),h=0,y=f.length;h<y;++h)(d=f[h])&&de(d,e,n,h,f,x);o.push(f),a.push(u)}return new j(o,a,e,n)}var Ga=Dt.prototype.constructor;function Va(){return new Ga(this._groups,this._parents)}function Ua(t,e){var n,r,i;return function(){var o=vt(this,t),a=(this.style.removeProperty(t),vt(this,t));return o===a?null:o===n&&a===r?i:i=e(n=o,r=a)}}function ar(t){return function(){this.style.removeProperty(t)}}function Wa(t,e,n){var r,i=n+"",o;return function(){var a=vt(this,t);return a===i?null:a===r?o:o=e(r=a,n)}}function Ka(t,e,n){var r,i,o;return function(){var a=vt(this,t),s=n(this),c=s+"";return s==null&&(c=s=(this.style.removeProperty(t),vt(this,t))),a===c?null:a===r&&c===i?o:(i=c,o=e(r=a,s))}}function Qa(t,e){var n,r,i,o="style."+e,a="end."+o,s;return function(){var c=W(this,t),l=c.on,u=c.value[o]==null?s||(s=ar(e)):void 0;(l!==n||i!==u)&&(r=(n=l).copy()).on(a,i=u),c.on=r}}function Za(t,e,n){var r=(t+="")=="transform"?ta:or;return e==null?this.styleTween(t,Ua(t,r)).on("end.style."+t,ar(t)):typeof e=="function"?this.styleTween(t,Ka(t,r,Ge(this,"style."+t,e))).each(Qa(this._id,t)):this.styleTween(t,Wa(t,r,e),n).on("end.style."+t,null)}function Ja(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function ja(t,e,n){var r,i;function o(){var a=e.apply(this,arguments);return a!==i&&(r=(i=a)&&Ja(t,a,n)),r}return o._value=e,o}function ts(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,ja(t,e,n??""))}function es(t){return function(){this.textContent=t}}function ns(t){return function(){var e=t(this);this.textContent=e??""}}function rs(t){return this.tween("text",typeof t=="function"?ns(Ge(this,"text",t)):es(t==null?"":t+""))}function is(t){return function(e){this.textContent=t.call(this,e)}}function os(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&is(i)),e}return r._value=t,r}function as(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,os(t))}function ss(){for(var t=this._name,e=this._id,n=sr(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a=r[o],s=a.length,c,l=0;l<s;++l)if(c=a[l]){var u=V(c,e);de(c,t,n,l,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new j(r,this._parents,t,n)}function ls(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(o,a){var s={value:a},c={value:function(){--i===0&&o()}};n.each(function(){var l=W(this,r),u=l.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(s),e._.interrupt.push(s),e._.end.push(c)),l.on=e}),i===0&&o()})}var cs=0;function j(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function sr(){return++cs}var K=Dt.prototype;j.prototype={constructor:j,select:qa,selectAll:Ba,selectChild:K.selectChild,selectChildren:K.selectChildren,filter:La,merge:Oa,selection:Va,transition:ss,call:K.call,nodes:K.nodes,node:K.node,size:K.size,empty:K.empty,each:K.each,on:Ha,attr:ba,attrTween:Ma,style:Za,styleTween:ts,text:rs,textTween:as,remove:Xa,tween:pa,delay:Ta,duration:Na,ease:Pa,easeVarying:za,end:ls,[Symbol.iterator]:K[Symbol.iterator]};function wn(t){return--t*t*t+1}function us(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Ve=1.70158;(function t(e){e=+e;function n(r){return(r=+r)*r*(e*(r-1)+r)}return n.overshoot=t,n})(Ve);var _n=function t(e){e=+e;function n(r){return--r*r*((r+1)*e+r)+1}return n.overshoot=t,n}(Ve);(function t(e){e=+e;function n(r){return((r*=2)<1?r*r*((e+1)*r-e):(r-=2)*r*((e+1)*r+e)+2)/2}return n.overshoot=t,n})(Ve);var fs={time:null,delay:0,duration:250,ease:us};function ds(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function ps(t){var e,n;t instanceof j?(e=t._id,t=t._name):(e=sr(),(n=fs).time=Xe(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a=r[o],s=a.length,c,l=0;l<s;++l)(c=a[l])&&de(c,t,e,l,a,n||ds(c,e));return new j(r,this._parents,t,e)}Dt.prototype.interrupt=ua;Dt.prototype.transition=ps;function hs(t,e){var n,r=1;t==null&&(t=0),e==null&&(e=0);function i(){var o,a=n.length,s,c=0,l=0;for(o=0;o<a;++o)s=n[o],c+=s.x,l+=s.y;for(c=(c/a-t)*r,l=(l/a-e)*r,o=0;o<a;++o)s=n[o],s.x-=c,s.y-=l}return i.initialize=function(o){n=o},i.x=function(o){return arguments.length?(t=+o,i):t},i.y=function(o){return arguments.length?(e=+o,i):e},i.strength=function(o){return arguments.length?(r=+o,i):r},i}function ys(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return lr(this.cover(e,n),e,n,t)}function lr(t,e,n,r){if(isNaN(e)||isNaN(n))return t;var i,o=t._root,a={data:r},s=t._x0,c=t._y0,l=t._x1,u=t._y1,p,f,d,x,h,y,v,m;if(!o)return t._root=a,t;for(;o.length;)if((h=e>=(p=(s+l)/2))?s=p:l=p,(y=n>=(f=(c+u)/2))?c=f:u=f,i=o,!(o=o[v=y<<1|h]))return i[v]=a,t;if(d=+t._x.call(null,o.data),x=+t._y.call(null,o.data),e===d&&n===x)return a.next=o,i?i[v]=a:t._root=a,t;do i=i?i[v]=new Array(4):t._root=new Array(4),(h=e>=(p=(s+l)/2))?s=p:l=p,(y=n>=(f=(c+u)/2))?c=f:u=f;while((v=y<<1|h)===(m=(x>=f)<<1|d>=p));return i[m]=o,i[v]=a,t}function gs(t){var e,n,r=t.length,i,o,a=new Array(r),s=new Array(r),c=1/0,l=1/0,u=-1/0,p=-1/0;for(n=0;n<r;++n)isNaN(i=+this._x.call(null,e=t[n]))||isNaN(o=+this._y.call(null,e))||(a[n]=i,s[n]=o,i<c&&(c=i),i>u&&(u=i),o<l&&(l=o),o>p&&(p=o));if(c>u||l>p)return this;for(this.cover(c,l).cover(u,p),n=0;n<r;++n)lr(this,a[n],s[n],t[n]);return this}function ms(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,r=this._y0,i=this._x1,o=this._y1;if(isNaN(n))i=(n=Math.floor(t))+1,o=(r=Math.floor(e))+1;else{for(var a=i-n||1,s=this._root,c,l;n>t||t>=i||r>e||e>=o;)switch(l=(e<r)<<1|t<n,c=new Array(4),c[l]=s,s=c,a*=2,l){case 0:i=n+a,o=r+a;break;case 1:n=i-a,o=r+a;break;case 2:i=n+a,r=o-a;break;case 3:n=i-a,r=o-a;break}this._root&&this._root.length&&(this._root=s)}return this._x0=n,this._y0=r,this._x1=i,this._y1=o,this}function xs(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function vs(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Y(t,e,n,r,i){this.node=t,this.x0=e,this.y0=n,this.x1=r,this.y1=i}function bs(t,e,n){var r,i=this._x0,o=this._y0,a,s,c,l,u=this._x1,p=this._y1,f=[],d=this._root,x,h;for(d&&f.push(new Y(d,i,o,u,p)),n==null?n=1/0:(i=t-n,o=e-n,u=t+n,p=e+n,n*=n);x=f.pop();)if(!(!(d=x.node)||(a=x.x0)>u||(s=x.y0)>p||(c=x.x1)<i||(l=x.y1)<o))if(d.length){var y=(a+c)/2,v=(s+l)/2;f.push(new Y(d[3],y,v,c,l),new Y(d[2],a,v,y,l),new Y(d[1],y,s,c,v),new Y(d[0],a,s,y,v)),(h=(e>=v)<<1|t>=y)&&(x=f[f.length-1],f[f.length-1]=f[f.length-1-h],f[f.length-1-h]=x)}else{var m=t-+this._x.call(null,d.data),b=e-+this._y.call(null,d.data),g=m*m+b*b;if(g<n){var _=Math.sqrt(n=g);i=t-_,o=e-_,u=t+_,p=e+_,r=d.data}}return r}function ws(t){if(isNaN(u=+this._x.call(null,t))||isNaN(p=+this._y.call(null,t)))return this;var e,n=this._root,r,i,o,a=this._x0,s=this._y0,c=this._x1,l=this._y1,u,p,f,d,x,h,y,v;if(!n)return this;if(n.length)for(;;){if((x=u>=(f=(a+c)/2))?a=f:c=f,(h=p>=(d=(s+l)/2))?s=d:l=d,e=n,!(n=n[y=h<<1|x]))return this;if(!n.length)break;(e[y+1&3]||e[y+2&3]||e[y+3&3])&&(r=e,v=y)}for(;n.data!==t;)if(i=n,!(n=n.next))return this;return(o=n.next)&&delete n.next,i?(o?i.next=o:delete i.next,this):e?(o?e[y]=o:delete e[y],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(r?r[v]=n:this._root=n),this):(this._root=o,this)}function _s(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function ks(){return this._root}function As(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function Ms(t){var e=[],n,r=this._root,i,o,a,s,c;for(r&&e.push(new Y(r,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(r=n.node,o=n.x0,a=n.y0,s=n.x1,c=n.y1)&&r.length){var l=(o+s)/2,u=(a+c)/2;(i=r[3])&&e.push(new Y(i,l,u,s,c)),(i=r[2])&&e.push(new Y(i,o,u,l,c)),(i=r[1])&&e.push(new Y(i,l,a,s,u)),(i=r[0])&&e.push(new Y(i,o,a,l,u))}return this}function Es(t){var e=[],n=[],r;for(this._root&&e.push(new Y(this._root,this._x0,this._y0,this._x1,this._y1));r=e.pop();){var i=r.node;if(i.length){var o,a=r.x0,s=r.y0,c=r.x1,l=r.y1,u=(a+c)/2,p=(s+l)/2;(o=i[0])&&e.push(new Y(o,a,s,u,p)),(o=i[1])&&e.push(new Y(o,u,s,c,p)),(o=i[2])&&e.push(new Y(o,a,p,u,l)),(o=i[3])&&e.push(new Y(o,u,p,c,l))}n.push(r)}for(;r=n.pop();)t(r.node,r.x0,r.y0,r.x1,r.y1);return this}function Ss(t){return t[0]}function Ts(t){return arguments.length?(this._x=t,this):this._x}function $s(t){return t[1]}function Cs(t){return arguments.length?(this._y=t,this):this._y}function Ue(t,e,n){var r=new We(e??Ss,n??$s,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function We(t,e,n,r,i,o){this._x=t,this._y=e,this._x0=n,this._y0=r,this._x1=i,this._y1=o,this._root=void 0}function kn(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var F=Ue.prototype=We.prototype;F.copy=function(){var t=new We(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,r;if(!e)return t;if(!e.length)return t._root=kn(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var i=0;i<4;++i)(r=e.source[i])&&(r.length?n.push({source:r,target:e.target[i]=new Array(4)}):e.target[i]=kn(r));return t};F.add=ys;F.addAll=gs;F.cover=ms;F.data=xs;F.extent=vs;F.find=bs;F.remove=ws;F.removeAll=_s;F.root=ks;F.size=As;F.visit=Ms;F.visitAfter=Es;F.x=Ts;F.y=Cs;function st(t){return function(){return t}}function nt(t){return(t()-.5)*1e-6}function Ns(t){return t.x+t.vx}function Rs(t){return t.y+t.vy}function Ps(t){var e,n,r,i=1,o=1;typeof t!="function"&&(t=st(t==null?1:+t));function a(){for(var l,u=e.length,p,f,d,x,h,y,v=0;v<o;++v)for(p=Ue(e,Ns,Rs).visitAfter(s),l=0;l<u;++l)f=e[l],h=n[f.index],y=h*h,d=f.x+f.vx,x=f.y+f.vy,p.visit(m);function m(b,g,_,A,S){var E=b.data,$=b.r,C=h+$;if(E){if(E.index>f.index){var M=d-E.x-E.vx,N=x-E.y-E.vy,w=M*M+N*N;w<C*C&&(M===0&&(M=nt(r),w+=M*M),N===0&&(N=nt(r),w+=N*N),w=(C-(w=Math.sqrt(w)))/w*i,f.vx+=(M*=w)*(C=($*=$)/(y+$)),f.vy+=(N*=w)*C,E.vx-=M*(C=1-C),E.vy-=N*C)}return}return g>d+C||A<d-C||_>x+C||S<x-C}}function s(l){if(l.data)return l.r=n[l.data.index];for(var u=l.r=0;u<4;++u)l[u]&&l[u].r>l.r&&(l.r=l[u].r)}function c(){if(e){var l,u=e.length,p;for(n=new Array(u),l=0;l<u;++l)p=e[l],n[p.index]=+t(p,l,e)}}return a.initialize=function(l,u){e=l,r=u,c()},a.iterations=function(l){return arguments.length?(o=+l,a):o},a.strength=function(l){return arguments.length?(i=+l,a):i},a.radius=function(l){return arguments.length?(t=typeof l=="function"?l:st(+l),c(),a):t},a}function Is(t){return t.index}function An(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function zs(t){var e=Is,n=p,r,i=st(30),o,a,s,c,l,u=1;t==null&&(t=[]);function p(y){return 1/Math.min(s[y.source.index],s[y.target.index])}function f(y){for(var v=0,m=t.length;v<u;++v)for(var b=0,g,_,A,S,E,$,C;b<m;++b)g=t[b],_=g.source,A=g.target,S=A.x+A.vx-_.x-_.vx||nt(l),E=A.y+A.vy-_.y-_.vy||nt(l),$=Math.sqrt(S*S+E*E),$=($-o[b])/$*y*r[b],S*=$,E*=$,A.vx-=S*(C=c[b]),A.vy-=E*C,_.vx+=S*(C=1-C),_.vy+=E*C}function d(){if(a){var y,v=a.length,m=t.length,b=new Map(a.map((_,A)=>[e(_,A,a),_])),g;for(y=0,s=new Array(v);y<m;++y)g=t[y],g.index=y,typeof g.source!="object"&&(g.source=An(b,g.source)),typeof g.target!="object"&&(g.target=An(b,g.target)),s[g.source.index]=(s[g.source.index]||0)+1,s[g.target.index]=(s[g.target.index]||0)+1;for(y=0,c=new Array(m);y<m;++y)g=t[y],c[y]=s[g.source.index]/(s[g.source.index]+s[g.target.index]);r=new Array(m),x(),o=new Array(m),h()}}function x(){if(a)for(var y=0,v=t.length;y<v;++y)r[y]=+n(t[y],y,t)}function h(){if(a)for(var y=0,v=t.length;y<v;++y)o[y]=+i(t[y],y,t)}return f.initialize=function(y,v){a=y,l=v,d()},f.links=function(y){return arguments.length?(t=y,d(),f):t},f.id=function(y){return arguments.length?(e=y,f):e},f.iterations=function(y){return arguments.length?(u=+y,f):u},f.strength=function(y){return arguments.length?(n=typeof y=="function"?y:st(+y),x(),f):n},f.distance=function(y){return arguments.length?(i=typeof y=="function"?y:st(+y),h(),f):i},f}const Ls=1664525,Os=1013904223,Mn=4294967296;function Ds(){let t=1;return()=>(t=(Ls*t+Os)%Mn)/Mn}function Ys(t){return t.x}function Hs(t){return t.y}var Fs=10,Xs=Math.PI*(3-Math.sqrt(5));function qs(t){var e,n=1,r=.001,i=1-Math.pow(r,1/300),o=0,a=.6,s=new Map,c=qe(p),l=ce("tick","end"),u=Ds();t==null&&(t=[]);function p(){f(),l.call("tick",e),n<r&&(c.stop(),l.call("end",e))}function f(h){var y,v=t.length,m;h===void 0&&(h=1);for(var b=0;b<h;++b)for(n+=(o-n)*i,s.forEach(function(g){g(n)}),y=0;y<v;++y)m=t[y],m.fx==null?m.x+=m.vx*=a:(m.x=m.fx,m.vx=0),m.fy==null?m.y+=m.vy*=a:(m.y=m.fy,m.vy=0);return e}function d(){for(var h=0,y=t.length,v;h<y;++h){if(v=t[h],v.index=h,v.fx!=null&&(v.x=v.fx),v.fy!=null&&(v.y=v.fy),isNaN(v.x)||isNaN(v.y)){var m=Fs*Math.sqrt(.5+h),b=h*Xs;v.x=m*Math.cos(b),v.y=m*Math.sin(b)}(isNaN(v.vx)||isNaN(v.vy))&&(v.vx=v.vy=0)}}function x(h){return h.initialize&&h.initialize(t,u),h}return d(),e={tick:f,restart:function(){return c.restart(p),e},stop:function(){return c.stop(),e},nodes:function(h){return arguments.length?(t=h,d(),s.forEach(x),e):t},alpha:function(h){return arguments.length?(n=+h,e):n},alphaMin:function(h){return arguments.length?(r=+h,e):r},alphaDecay:function(h){return arguments.length?(i=+h,e):+i},alphaTarget:function(h){return arguments.length?(o=+h,e):o},velocityDecay:function(h){return arguments.length?(a=1-h,e):1-a},randomSource:function(h){return arguments.length?(u=h,s.forEach(x),e):u},force:function(h,y){return arguments.length>1?(y==null?s.delete(h):s.set(h,x(y)),e):s.get(h)},find:function(h,y,v){var m=0,b=t.length,g,_,A,S,E;for(v==null?v=1/0:v*=v,m=0;m<b;++m)S=t[m],g=h-S.x,_=y-S.y,A=g*g+_*_,A<v&&(E=S,v=A);return E},on:function(h,y){return arguments.length>1?(l.on(h,y),e):l.on(h)}}}function Bs(){var t,e,n,r,i=st(-30),o,a=1,s=1/0,c=.81;function l(d){var x,h=t.length,y=Ue(t,Ys,Hs).visitAfter(p);for(r=d,x=0;x<h;++x)e=t[x],y.visit(f)}function u(){if(t){var d,x=t.length,h;for(o=new Array(x),d=0;d<x;++d)h=t[d],o[h.index]=+i(h,d,t)}}function p(d){var x=0,h,y,v=0,m,b,g;if(d.length){for(m=b=g=0;g<4;++g)(h=d[g])&&(y=Math.abs(h.value))&&(x+=h.value,v+=y,m+=y*h.x,b+=y*h.y);d.x=m/v,d.y=b/v}else{h=d,h.x=h.data.x,h.y=h.data.y;do x+=o[h.data.index];while(h=h.next)}d.value=x}function f(d,x,h,y){if(!d.value)return!0;var v=d.x-e.x,m=d.y-e.y,b=y-x,g=v*v+m*m;if(b*b/c<g)return g<s&&(v===0&&(v=nt(n),g+=v*v),m===0&&(m=nt(n),g+=m*m),g<a&&(g=Math.sqrt(a*g)),e.vx+=v*d.value*r/g,e.vy+=m*d.value*r/g),!0;if(d.length||g>=s)return;(d.data!==e||d.next)&&(v===0&&(v=nt(n),g+=v*v),m===0&&(m=nt(n),g+=m*m),g<a&&(g=Math.sqrt(a*g)));do d.data!==e&&(b=o[d.data.index]*r/g,e.vx+=v*b,e.vy+=m*b);while(d=d.next)}return l.initialize=function(d,x){t=d,n=x,u()},l.strength=function(d){return arguments.length?(i=typeof d=="function"?d:st(+d),u(),l):i},l.distanceMin=function(d){return arguments.length?(a=d*d,l):Math.sqrt(a)},l.distanceMax=function(d){return arguments.length?(s=d*d,l):Math.sqrt(s)},l.theta=function(d){return arguments.length?(c=d*d,l):Math.sqrt(c)},l}function Gs(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function oe(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function _t(t){return t=oe(Math.abs(t)),t?t[1]:NaN}function Vs(t,e){return function(n,r){for(var i=n.length,o=[],a=0,s=t[0],c=0;i>0&&s>0&&(c+s+1>r&&(s=Math.max(1,r-c)),o.push(n.substring(i-=s,i+s)),!((c+=s+1)>r));)s=t[a=(a+1)%t.length];return o.reverse().join(e)}}function Us(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Ws=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ae(t){if(!(e=Ws.exec(t)))throw new Error("invalid format: "+t);var e;return new Ke({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}ae.prototype=Ke.prototype;function Ke(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Ke.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Ks(t){t:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var cr;function Qs(t,e){var n=oe(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(cr=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+oe(t,Math.max(0,e+o-1))[0]}function En(t,e){var n=oe(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const Sn={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Gs,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>En(t*100,e),r:En,s:Qs,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Tn(t){return t}var $n=Array.prototype.map,Cn=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Zs(t){var e=t.grouping===void 0||t.thousands===void 0?Tn:Vs($n.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?Tn:Us($n.call(t.numerals,String)),a=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"−":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function l(p){p=ae(p);var f=p.fill,d=p.align,x=p.sign,h=p.symbol,y=p.zero,v=p.width,m=p.comma,b=p.precision,g=p.trim,_=p.type;_==="n"?(m=!0,_="g"):Sn[_]||(b===void 0&&(b=12),g=!0,_="g"),(y||f==="0"&&d==="=")&&(y=!0,f="0",d="=");var A=h==="$"?n:h==="#"&&/[boxX]/.test(_)?"0"+_.toLowerCase():"",S=h==="$"?r:/[%p]/.test(_)?a:"",E=Sn[_],$=/[defgprs%]/.test(_);b=b===void 0?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function C(M){var N=A,w=S,k,I,T;if(_==="c")w=E(M)+w,M="";else{M=+M;var R=M<0||1/M<0;if(M=isNaN(M)?c:E(Math.abs(M),b),g&&(M=Ks(M)),R&&+M==0&&x!=="+"&&(R=!1),N=(R?x==="("?x:s:x==="-"||x==="("?"":x)+N,w=(_==="s"?Cn[8+cr/3]:"")+w+(R&&x==="("?")":""),$){for(k=-1,I=M.length;++k<I;)if(T=M.charCodeAt(k),48>T||T>57){w=(T===46?i+M.slice(k+1):M.slice(k))+w,M=M.slice(0,k);break}}}m&&!y&&(M=e(M,1/0));var L=N.length+M.length+w.length,D=L<v?new Array(v-L+1).join(f):"";switch(m&&y&&(M=e(D+M,D.length?v-w.length:1/0),D=""),d){case"<":M=N+M+w+D;break;case"=":M=N+D+M+w;break;case"^":M=D.slice(0,L=D.length>>1)+N+M+w+D.slice(L);break;default:M=D+N+M+w;break}return o(M)}return C.toString=function(){return p+""},C}function u(p,f){var d=l((p=ae(p),p.type="f",p)),x=Math.max(-8,Math.min(8,Math.floor(_t(f)/3)))*3,h=Math.pow(10,-x),y=Cn[8+x/3];return function(v){return d(h*v)+y}}return{format:l,formatPrefix:u}}var Gt,se,ur;Js({thousands:",",grouping:[3],currency:["$",""]});function Js(t){return Gt=Zs(t),se=Gt.format,ur=Gt.formatPrefix,Gt}function js(t){return Math.max(0,-_t(Math.abs(t)))}function tl(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(_t(e)/3)))*3-_t(Math.abs(t)))}function el(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,_t(e)-_t(t))+1}function nl(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function rl(t){return function(){return t}}function il(t){return+t}var Nn=[0,1];function pt(t){return t}function Ie(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:rl(isNaN(e)?NaN:.5)}function ol(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function al(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=Ie(i,r),o=n(a,o)):(r=Ie(r,i),o=n(o,a)),function(s){return o(r(s))}}function sl(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++a<r;)i[a]=Ie(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(s){var c=Sr(t,s,1,r)-1;return o[c](i[c](s))}}function ll(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function cl(){var t=Nn,e=Nn,n=Fe,r,i,o,a=pt,s,c,l;function u(){var f=Math.min(t.length,e.length);return a!==pt&&(a=ol(t[0],t[f-1])),s=f>2?sl:al,c=l=null,p}function p(f){return f==null||isNaN(f=+f)?o:(c||(c=s(t.map(r),e,n)))(r(a(f)))}return p.invert=function(f){return a(i((l||(l=s(e,t.map(r),B)))(f)))},p.domain=function(f){return arguments.length?(t=Array.from(f,il),u()):t.slice()},p.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},p.rangeRound=function(f){return e=Array.from(f),n=Zo,u()},p.clamp=function(f){return arguments.length?(a=f?!0:pt,u()):a!==pt},p.interpolate=function(f){return arguments.length?(n=f,u()):n},p.unknown=function(f){return arguments.length?(o=f,p):o},function(f,d){return r=f,i=d,u()}}function ul(){return cl()(pt,pt)}function fl(t,e,n,r){var i=Rr(t,e,n),o;switch(r=ae(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(o=tl(i,a))&&(r.precision=o),ur(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=el(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=js(i))&&(r.precision=o-(r.type==="%")*2);break}}return se(r)}function dl(t){var e=t.domain;return t.ticks=function(n){var r=e();return Nr(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return fl(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,o=r.length-1,a=r[i],s=r[o],c,l,u=10;for(s<a&&(l=a,a=s,s=l,l=i,i=o,o=l);u-- >0;){if(l=Ae(a,s,n),l===c)return r[i]=a,r[o]=s,e(r);if(l>0)a=Math.floor(a/l)*l,s=Math.ceil(s/l)*l;else if(l<0)a=Math.ceil(a*l)/l,s=Math.floor(s*l)/l;else break;c=l}return t},t}function rt(){var t=ul();return t.copy=function(){return ll(t,rt())},nl.apply(t,arguments),dl(t)}function Rt(t,e,n){this.k=t,this.x=e,this.y=n}Rt.prototype={constructor:Rt,scale:function(t){return t===1?this:new Rt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Rt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Rt.prototype;const fr=_r(),St=[{term:"Diabetes",category:"diseases",x:.2,y:.3,similarity:.9},{term:"Insulin",category:"treatments",x:.25,y:.35,similarity:.85},{term:"Blood Sugar",category:"symptoms",x:.22,y:.32,similarity:.8},{term:"Glucose",category:"biomarkers",x:.24,y:.34,similarity:.75},{term:"Pancreas",category:"organs",x:.18,y:.28,similarity:.7},{term:"Heart Disease",category:"diseases",x:.8,y:.7,similarity:.9},{term:"Cholesterol",category:"biomarkers",x:.75,y:.65,similarity:.85},{term:"Blood Pressure",category:"symptoms",x:.82,y:.72,similarity:.8},{term:"Cardiovascular",category:"systems",x:.78,y:.68,similarity:.75},{term:"Cancer",category:"diseases",x:.3,y:.8,similarity:.9},{term:"Tumor",category:"conditions",x:.35,y:.75,similarity:.85},{term:"Oncology",category:"specialties",x:.32,y:.82,similarity:.8},{term:"Chemotherapy",category:"treatments",x:.28,y:.78,similarity:.75},{term:"Asthma",category:"diseases",x:.7,y:.2,similarity:.9},{term:"Lungs",category:"organs",x:.65,y:.25,similarity:.85},{term:"Breathing",category:"symptoms",x:.72,y:.18,similarity:.8},{term:"Car Engine",category:"mechanical",x:.9,y:.9,similarity:.1},{term:"Cooking",category:"lifestyle",x:.1,y:.1,similarity:.05}],pl={diseases:"#d32f2f",treatments:"#1976d2",symptoms:"#f57c00",biomarkers:"#7b1fa2",organs:"#388e3c",systems:"#455a64",conditions:"#e65100",specialties:"#6a1b9a",mechanical:"#757575",lifestyle:"#616161"},hl=()=>{const t=P("#embeddings-viz");t.html("");const e={top:40,right:40,bottom:40,left:40},n=800-e.left-e.right,r=500-e.top-e.bottom,o=t.append("svg").attr("width",n+e.left+e.right).attr("height",r+e.top+e.bottom).style("background","white").style("border-radius","8px").style("box-shadow","0 2px 4px rgba(0,0,0,0.1)").append("g").attr("transform",`translate(${e.left},${e.top})`),a=rt().domain([0,1]).range([0,n]),s=rt().domain([0,1]).range([r,0]),c=rt().domain([0,1]).range([4,12]),l=Ln(a).ticks(5).tickFormat(se(".1f")),u=On(s).ticks(5).tickFormat(se(".1f"));o.append("g").attr("class","x-axis").attr("transform",`translate(0,${r})`).call(l),o.append("g").attr("class","y-axis").call(u),o.append("text").attr("class","title").attr("text-anchor","middle").attr("x",n/2).attr("y",-10).style("font-size","16px").style("font-weight","600").text("Medical Terms in Vector Space");const p=o.selectAll(".point").data(St).enter().append("g").attr("class","point").style("cursor","pointer");p.append("circle").attr("cx",h=>a(h.x)).attr("cy",h=>s(h.y)).attr("r",h=>c(h.similarity)).attr("fill",h=>pl[h.category]).attr("stroke","#333").attr("stroke-width",1).attr("opacity",.8).on("mouseover",function(h,y){P(this).attr("stroke-width",3).attr("opacity",1),d(h,y)}).on("mouseout",function(){P(this).attr("stroke-width",1).attr("opacity",.8),x()}),p.append("text").attr("x",h=>a(h.x)+15).attr("y",h=>s(h.y)).attr("dy","0.35em").style("font-size","11px").style("font-weight","500").style("fill","#333").style("pointer-events","none").text(h=>h.term),[{name:"Diabetes",center:{x:.22,y:.32},points:St.filter(h=>["Diabetes","Insulin","Blood Sugar","Glucose","Pancreas"].includes(h.term))},{name:"Cardiovascular",center:{x:.79,y:.69},points:St.filter(h=>["Heart Disease","Cholesterol","Blood Pressure","Cardiovascular"].includes(h.term))},{name:"Oncology",center:{x:.31,y:.79},points:St.filter(h=>["Cancer","Tumor","Oncology","Chemotherapy"].includes(h.term))},{name:"Respiratory",center:{x:.69,y:.21},points:St.filter(h=>["Asthma","Lungs","Breathing"].includes(h.term))}].forEach(h=>{if(h.points.length>2){const y=h.points.map(g=>g.x),v=h.points.map(g=>g.y),m=en(y)-nn(y),b=en(v)-nn(v);o.append("ellipse").attr("cx",a(h.center.x)).attr("cy",s(h.center.y)).attr("rx",a(m)*.8).attr("ry",s(b)*.8).attr("fill","none").attr("stroke","#ccc").attr("stroke-width",1).attr("stroke-dasharray","5,5").attr("opacity",.6),o.append("text").attr("x",a(h.center.x)).attr("y",s(h.center.y)-20).attr("text-anchor","middle").style("font-size","12px").style("font-weight","600").style("fill","#666").text(h.name)}});function d(h,y){const v=P("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0,0,0,0.9)").style("color","white").style("padding","8px 12px").style("border-radius","4px").style("font-size","12px").style("pointer-events","none").style("z-index",1e3).style("box-shadow","0 2px 8px rgba(0,0,0,0.3)");v.html(`
      <strong>${y.term}</strong><br>
      Category: ${y.category}<br>
      Position: (${y.x.toFixed(2)}, ${y.y.toFixed(2)})
    `),v.style("left",h.pageX+10+"px").style("top",h.pageY-10+"px")}function x(){bt(".tooltip").remove()}},yl=()=>{const t=P("#rag-viz");t.html("");const e=1e3,n=600,r=t.append("div").style("width",e+"px").style("height",n+"px").style("position","relative").style("background","white").style("border-radius","8px").style("box-shadow","0 2px 4px rgba(0,0,0,0.1)"),o=r.append("svg").attr("width",e).attr("height",n).style("background","white").style("border-radius","8px").append("g").attr("transform","translate(20, 20)"),a=o.append("g").attr("class","document-area").attr("transform","translate(0, 0)"),s=o.append("g").attr("class","vector-area").attr("transform",`translate(${e-400}, 0)`),c={title:"Understanding Diabetes",chunks:[{id:"chunk1",text:"Diabetes is a chronic condition that affects how your body processes glucose. When you have diabetes, your pancreas either doesn't produce enough insulin or your cells don't respond properly to insulin.",category:"definition",docX:50,docY:80,docWidth:300,docHeight:100,vecX:.2,vecY:.3},{id:"chunk2",text:"The most common symptoms of diabetes include increased thirst, frequent urination, and unexplained weight loss. Some people also experience fatigue, blurred vision, and slow-healing wounds.",category:"symptoms",docX:50,docY:200,docWidth:300,docHeight:100,vecX:.25,vecY:.35},{id:"chunk3",text:"Treatment for diabetes typically involves lifestyle changes such as diet modification and regular exercise. Many patients also require medication like insulin injections or oral medications.",category:"treatment",docX:50,docY:320,docWidth:300,docHeight:100,vecX:.3,vecY:.4}],query:{text:"What are the symptoms of diabetes?",docX:50,docY:440,docWidth:300,docHeight:40,vecX:.24,vecY:.34}},l={definition:"#d32f2f",symptoms:"#1976d2",treatment:"#388e3c",query:"#ff9800"},u=(w,k,I=16)=>{const T=w.split(" "),R=[];let L=T[0];for(let D=1;D<T.length;D++){const q=T[D],tt=L+" "+q;tt.length*6.5>k-20?(R.push(L),L=q):L=tt}return R.push(L),R},p=rt().domain([0,1]).range([0,350]),f=rt().domain([0,1]).range([350,0]),d=a.append("text").attr("x",0).attr("y",30).style("font-size","18px").style("font-weight","600").style("fill","#333").style("opacity",0).text(c.title),x=a.selectAll(".chunk-group").data(c.chunks).enter().append("g").attr("class","chunk-group").attr("transform",w=>`translate(${w.docX}, ${w.docY})`).style("opacity",0);x.append("rect").attr("width",w=>w.docWidth).attr("height",w=>w.docHeight).attr("rx",8).attr("ry",8).attr("fill","none").attr("stroke",w=>l[w.category]).attr("stroke-width",2).attr("stroke-dasharray","5,5").attr("opacity",.8),x.each(function(w){const k=u(w.text,w.docWidth),I=P(this);k.forEach((T,R)=>{I.append("text").attr("x",10).attr("y",20+R*16).style("font-size","12px").style("fill","#555").style("pointer-events","none").text(T)})}),x.append("text").attr("x",w=>w.docWidth-10).attr("y",15).attr("text-anchor","end").style("font-size","10px").style("font-weight","600").style("fill",w=>l[w.category]).style("pointer-events","none").text(w=>w.category.toUpperCase());const h=a.append("g").attr("class","query-group").attr("transform",`translate(${c.query.docX}, ${c.query.docY})`).style("opacity",0);h.append("rect").attr("width",c.query.docWidth).attr("height",c.query.docHeight).attr("rx",8).attr("ry",8).attr("fill","none").attr("stroke",l.query).attr("stroke-width",2).attr("stroke-dasharray","5,5").attr("opacity",.8),h.append("text").attr("x",10).attr("y",25).style("font-size","12px").style("fill","#555").style("pointer-events","none").text(c.query.text),h.append("text").attr("x",c.query.docWidth-10).attr("y",15).attr("text-anchor","end").style("font-size","10px").style("font-weight","600").style("fill",l.query).style("pointer-events","none").text("QUERY"),s.append("rect").attr("width",350).attr("height",350).attr("fill","#f8f9fa").attr("stroke","#e9ecef").attr("stroke-width",2).attr("rx",8).attr("ry",8),s.append("text").attr("x",175).attr("y",25).attr("text-anchor","middle").style("font-size","14px").style("font-weight","600").style("fill","#333").text("Vector Space");const y=Ln(p).ticks(5),v=On(f).ticks(5);s.append("g").attr("class","x-axis").attr("transform","translate(0, 350)").call(y),s.append("g").attr("class","y-axis").call(v);const m=s.selectAll(".vector-circle").data(c.chunks).enter().append("g").attr("class","vector-circle").style("opacity",0);m.append("circle").attr("cx",w=>p(w.vecX)).attr("cy",w=>f(w.vecY)).attr("r",8).attr("fill",w=>l[w.category]).attr("stroke","#333").attr("stroke-width",2),m.append("text").attr("x",w=>p(w.vecX)+15).attr("y",w=>f(w.vecY)).attr("dy","0.35em").style("font-size","10px").style("font-weight","500").style("fill","#333").style("pointer-events","none").text(w=>w.category);const b=s.append("g").attr("class","query-vector").style("opacity",0);b.append("polygon").attr("points","0,8 2,2 8,2 3,-2 5,-8 0,-4 -5,-8 -3,-2 -8,2 -2,2").attr("fill",l.query).attr("stroke","#333").attr("stroke-width",2).attr("transform",`translate(${p(c.query.vecX)}, ${f(c.query.vecY)})`),b.append("text").attr("x",p(c.query.vecX)+20).attr("y",f(c.query.vecY)).attr("dy","0.35em").style("font-size","10px").style("font-weight","500").style("fill","#333").style("pointer-events","none").text("Query");const _=s.append("line").attr("class","retrieval-line").attr("x1",p(c.query.vecX)).attr("y1",f(c.query.vecY)).attr("x2",p(c.chunks[1].vecX)).attr("y2",f(c.chunks[1].vecY)).attr("stroke","#ff5722").attr("stroke-width",3).attr("stroke-dasharray","5,5").style("opacity",0);let A=0;const S=6;let E=!1,$=null;const C=()=>{if(!E)switch(A){case 0:d.transition().duration(500).style("opacity",1),x.transition().duration(500).style("opacity",1);break;case 1:h.transition().duration(500).style("opacity",1);break;case 2:x.transition().duration(1500).ease(wn).attr("transform",w=>`translate(${e-400+p(w.vecX)}, ${f(w.vecY)}) scale(0.3)`).style("opacity",.2),m.transition().duration(1e3).delay(1500).ease(_n).style("opacity",1).attr("transform","scale(0)").transition().duration(300).attr("transform","scale(1)");break;case 3:h.transition().duration(1500).ease(wn).attr("transform",`translate(${e-400+p(c.query.vecX)}, ${f(c.query.vecY)}) scale(0.3)`).style("opacity",.2),b.transition().duration(1e3).delay(1500).ease(_n).style("opacity",1).attr("transform","scale(0)").transition().duration(300).attr("transform","scale(1)");break;case 4:_.transition().duration(1e3).style("opacity",1);break;case 5:m.select("circle").transition().duration(500).attr("r",12).attr("stroke-width",4);break}},M=()=>{E||A<S-1&&(A++,C(),$=setTimeout(M,2500))};setTimeout(()=>{C(),$=setTimeout(M,1500)},1e3);const N=r.append("button").style("position","absolute").style("bottom","20px").style("left","20px").style("padding","8px 16px").style("background","#ff9800").style("color","white").style("border","none").style("border-radius","4px").style("cursor","pointer").style("font-size","12px").text("Pause").on("click",()=>{E?(E=!1,N.style("background","#ff9800").text("Pause"),A<S-1&&($=setTimeout(M,1e3))):(E=!0,N.style("background","#4caf50").text("Resume"),$&&(clearTimeout($),$=null))});r.append("button").style("position","absolute").style("bottom","20px").style("right","20px").style("padding","8px 16px").style("background","#1976d2").style("color","white").style("border","none").style("border-radius","4px").style("cursor","pointer").style("font-size","12px").text("Restart Animation").on("click",()=>{A=0,E=!1,$&&(clearTimeout($),$=null),N.style("background","#ff9800").text("Pause"),d.style("opacity",0),x.style("opacity",0).attr("transform",w=>`translate(${w.docX}, ${w.docY})`),h.style("opacity",0).attr("transform",`translate(${c.query.docX}, ${c.query.docY})`),m.style("opacity",0),b.style("opacity",0),_.style("opacity",0),m.select("circle").attr("r",8).attr("stroke-width",2),setTimeout(()=>{C(),$=setTimeout(M,1500)},1e3)}),m.on("mouseover",function(w,k){const I=P("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0,0,0,0.9)").style("color","white").style("padding","8px 12px").style("border-radius","4px").style("font-size","12px").style("pointer-events","none").style("z-index",1e3).style("max-width","300px");I.html(`
      <strong>${k.category.toUpperCase()}</strong><br>
      ${k.text.substring(0,100)}...
    `),I.style("left",w.pageX+10+"px").style("top",w.pageY-10+"px")}).on("mouseout",()=>{bt(".tooltip").remove()})},Tt={nodes:[{id:"diabetes",name:"Diabetes",acronym:"DM",type:"disease",x:400,y:200,properties:{"ICD-10":"E11.9",Prevalence:"9.3% of US population",Type:"Type 2 Diabetes Mellitus","Risk Factors":"Obesity, Family History, Age"}},{id:"metformin",name:"Metformin",acronym:"MET",type:"drug",x:200,y:150,properties:{"Generic Name":"Metformin Hydrochloride","Drug Class":"Biguanide","FDA Approval":"1994",Mechanism:"Reduces hepatic glucose production"}},{id:"insulin",name:"Insulin",acronym:"INS",type:"drug",x:200,y:250,properties:{"Generic Name":"Human Insulin","Drug Class":"Hormone",Administration:"Subcutaneous injection",Types:"Rapid-acting, Long-acting, Mixed"}},{id:"glucose",name:"High Glucose",acronym:"HG",type:"symptom",x:600,y:150,properties:{"Normal Range":"70-140 mg/dL",Diagnostic:">200 mg/dL fasting",Symptoms:"Frequent urination, Thirst, Fatigue",Measurement:"Blood glucose test"}},{id:"kidney",name:"Kidney Disease",acronym:"CKD",type:"disease",x:600,y:250,properties:{"ICD-10":"N18.9",Stages:"1-5 (5 being end-stage)","eGFR Threshold":"<60 mL/min/1.73m²",Complications:"Anemia, Bone disease, CVD"}},{id:"gastro",name:"GI Upset",acronym:"GI",type:"symptom",x:100,y:100,properties:{"Common Symptoms":"Nausea, Diarrhea, Abdominal pain",Onset:"Usually within 1-2 weeks",Management:"Take with food, Gradual titration",Frequency:"Up to 30% of patients"}},{id:"monitoring",name:"Blood Tests",acronym:"BT",type:"procedure",x:300,y:350,properties:{"Test Type":"HbA1c, Fasting glucose",Frequency:"Every 3-6 months","Target HbA1c":"<7%",Cost:"$20-50 per test"}},{id:"lifestyle",name:"Lifestyle Changes",acronym:"LC",type:"treatment",x:500,y:350,properties:{Components:"Diet, Exercise, Weight loss",Efficacy:"Can reduce HbA1c by 1-2%",Recommendations:"150 min/week exercise",Diet:"Low-carb, Mediterranean"}}],links:[{source:"metformin",target:"diabetes",label:"treats",acronym:"TRT",strength:.9,properties:{"Evidence Level":"A (Strong)",Dosage:"500-2550 mg daily",Efficacy:"Reduces HbA1c by 1-2%","First Line":"Yes, recommended first-line therapy"}},{source:"insulin",target:"diabetes",label:"treats",acronym:"TRT",strength:.9,properties:{"Evidence Level":"A (Strong)",Indication:"When oral agents insufficient",Dosage:"Variable based on blood glucose",Administration:"Subcutaneous injection"}},{source:"diabetes",target:"glucose",label:"causes",acronym:"CAU",strength:.8,properties:{Mechanism:"Insulin resistance and deficiency","Time Course":"Chronic, progressive",Reversibility:"Partial with treatment",Monitoring:"Regular blood glucose checks"}},{source:"metformin",target:"gastro",label:"side effect",acronym:"SE",strength:.7,properties:{Frequency:"Up to 30% of patients",Onset:"Usually within 1-2 weeks",Severity:"Mild to moderate",Management:"Take with food, gradual titration"}},{source:"metformin",target:"kidney",label:"contraindicated in",acronym:"CI",strength:.6,properties:{Threshold:"eGFR <30 mL/min/1.73m²",Risk:"Lactic acidosis",Alternative:"Insulin or other agents",Monitoring:"Regular kidney function tests"}},{source:"diabetes",target:"kidney",label:"complicates",acronym:"CMP",strength:.8,properties:{Mechanism:"Hyperglycemia damages kidney vessels",Prevalence:"20-40% of diabetic patients",Prevention:"Good glycemic control",Screening:"Annual urine albumin test"}},{source:"diabetes",target:"monitoring",label:"requires",acronym:"REQ",strength:.9,properties:{Frequency:"Every 3-6 months",Tests:"HbA1c, Fasting glucose, Kidney function",Targets:"HbA1c <7%, BP <140/90",Cost:"$200-500 annually"}},{source:"lifestyle",target:"diabetes",label:"manages",acronym:"MNG",strength:.7,properties:{Efficacy:"Can reduce HbA1c by 1-2%",Components:"Diet, Exercise, Weight loss",Sustainability:"Long-term lifestyle changes",Support:"Diabetes education programs"}},{source:"monitoring",target:"glucose",label:"measures",acronym:"MSR",strength:.8,properties:{"Test Type":"Blood glucose, HbA1c",Accuracy:"Laboratory standard",Frequency:"As needed for control",Interpretation:"Compare to target ranges"}}]},be={disease:"#d32f2f",drug:"#1976d2",symptom:"#f57c00",procedure:"#7b1fa2",treatment:"#388e3c"},gl={treats:"#388e3c",causes:"#d32f2f","side effect":"#f57c00","contraindicated in":"#d32f2f",complicates:"#d32f2f",requires:"#1976d2",manages:"#388e3c",measures:"#7b1fa2"},ml=()=>{const t=P("#knowledge-graph-viz");t.html("");const e={top:40,right:40,bottom:40,left:40},n=800-e.left-e.right,r=500-e.top-e.bottom,i=t.append("svg").attr("width",n+e.left+e.right).attr("height",r+e.top+e.bottom).style("background","white").style("border-radius","8px").style("box-shadow","0 2px 4px rgba(0,0,0,0.1)"),o=i.append("g").attr("transform",`translate(${e.left},${e.top})`);rt().domain([0,800]).range([0,n]),rt().domain([0,500]).range([r,0]);const a=qs(Tt.nodes).force("link",zs(Tt.links).id(m=>m.id).distance(100)).force("charge",Bs().strength(-300)).force("center",hs(n/2,r/2)).force("collision",Ps().radius(30));i.append("defs").selectAll("marker").data(["arrow"]).enter().append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",25).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill","#666");const s=o.append("g").selectAll("g").data(Tt.links).enter().append("g").attr("class","link");s.append("line").attr("stroke",m=>gl[m.label]||"#666").attr("stroke-width",m=>m.strength*3).attr("stroke-opacity",.6).attr("marker-end","url(#arrow)").on("mouseover",function(m,b){P(this).attr("stroke-width",b.strength*5).attr("stroke-opacity",1),d(m,b)}).on("mouseout",function(m,b){P(this).attr("stroke-width",b.strength*3).attr("stroke-opacity",.6),h()}),s.append("text").attr("dy",-5).style("font-size","10px").style("font-weight","500").style("fill","#333").style("text-anchor","middle").style("pointer-events","none").text(m=>m.acronym);const c=o.append("g").selectAll("g").data(Tt.nodes).enter().append("g").attr("class","node").style("cursor","pointer").call(To().on("start",l).on("drag",u).on("end",p));c.append("circle").attr("r",20).attr("fill",m=>be[m.type]).attr("stroke","#333").attr("stroke-width",2).attr("opacity",.8).on("mouseover",function(m,b){P(this).attr("stroke-width",4).attr("opacity",1),o.selectAll(".link line").attr("stroke-opacity",g=>g.source.id===b.id||g.target.id===b.id?1:.2),o.selectAll(".link text").style("opacity",.3),f(m,b)}).on("mouseout",function(){P(this).attr("stroke-width",2).attr("opacity",.8),o.selectAll(".link line").attr("stroke-opacity",.6),o.selectAll(".link text").style("opacity",1),x()}),c.append("text").attr("dy","0.35em").style("font-size","11px").style("font-weight","600").style("fill","white").style("text-anchor","middle").style("pointer-events","none").text(m=>m.acronym),a.on("tick",()=>{s.select("line").attr("x1",m=>m.source.x).attr("y1",m=>m.source.y).attr("x2",m=>m.target.x).attr("y2",m=>m.target.y),s.select("text").attr("x",m=>(m.source.x+m.target.x)/2).attr("y",m=>(m.source.y+m.target.y)/2),c.attr("transform",m=>`translate(${m.x},${m.y})`)});function l(m,b){m.active||a.alphaTarget(.3).restart(),b.fx=b.x,b.fy=b.y}function u(m,b){b.fx=m.x,b.fy=m.y}function p(m,b){m.active||a.alphaTarget(0),b.fx=null,b.fy=null}function f(m,b){const g=P("body").append("div").attr("class","tooltip").style("opacity",0);g.transition().duration(200).style("opacity",1);const _=Object.entries(b.properties).map(([A,S])=>`<strong>${A}:</strong> ${S}`).join("<br/>");g.html(`
      <strong>${b.name}</strong> (${b.acronym})<br/>
      Type: ${b.type}<br/>
      Connections: ${Tt.links.filter(A=>A.source.id===b.id||A.target.id===b.id).length}<br/><br/>
      <strong>Properties:</strong><br/>
      ${_}
    `).style("left",m.pageX+10+"px").style("top",m.pageY-10+"px")}function d(m,b){const g=P("body").append("div").attr("class","tooltip").style("opacity",0);g.transition().duration(200).style("opacity",1);const _=Object.entries(b.properties).map(([A,S])=>`<strong>${A}:</strong> ${S}`).join("<br/>");g.html(`
      <strong>${b.label}</strong> (${b.acronym})<br/>
      From: ${b.source.name} → To: ${b.target.name}<br/>
      Strength: ${b.strength}<br/><br/>
      <strong>Properties:</strong><br/>
      ${_}
    `).style("left",m.pageX+10+"px").style("top",m.pageY-10+"px")}function x(){bt(".tooltip").remove()}function h(){bt(".tooltip").remove()}const y=i.append("g").attr("transform",`translate(${n-150}, 20)`);Object.keys(be).forEach((m,b)=>{const g=y.append("g").attr("transform",`translate(0, ${b*25})`);g.append("circle").attr("r",8).attr("fill",be[m]).attr("stroke","#333").attr("stroke-width",1),g.append("text").attr("x",15).attr("dy","0.35em").style("font-size","10px").style("fill","#333").text(m)}),o.append("text").attr("class","title").attr("text-anchor","middle").attr("x",n/2).attr("y",-10).style("font-size","16px").style("font-weight","600").text("Medical Knowledge Graph")},kt={embeddings:0,"smarter-chunking":0,"advanced-retrieval":0,"contextual-refinements":0,"external-tools":0,"knowledge-graphs-intro":0,"graphrag-approaches":0,"graphrag-advantages":0,"medgraphrag-intro":0,"graph-construction":0,"performance-results":0,conclusion:0},mt={embeddings:3,"smarter-chunking":4,"advanced-retrieval":3,"contextual-refinements":4,"external-tools":5,"knowledge-graphs-intro":4,"graphrag-approaches":4,"graphrag-advantages":4,"medgraphrag-intro":3,"graph-construction":3,"performance-results":4,conclusion:4};mt["graph-construction"]=3;const xl=dr;window.changeSlide=function(t,e){if(t==="graph-construction"){const n=kt[t],r=mt[t];if(n===r-1&&e===1){for(let i=0;i<r;i++){const o=document.getElementById(`${t}-${i+1}`);o&&(o.style.display="none")}Sl("overall-graph-structure");return}}xl(t,e)};const vl=Qe;window.updateProgressDots=function(t,e){if(t==="graph-construction"){const n=document.getElementById(`${t}-${e+1}`);if(!n)return;n.querySelectorAll(".dot").forEach((i,o)=>{o<3?(i.style.display="",i.classList.toggle("active",o===e)):i.style.display="none"});return}vl(t,e)};const bl=Ze;window.updateNavigationButtons=function(t,e,n){if(t==="graph-construction"){const r=document.getElementById(`${t}-${e+1}`);if(!r)return;const i=r.querySelector(".prev-btn"),o=r.querySelector(".next-btn");i&&(i.disabled=e===0),o&&(o.disabled=e===n-1);return}bl(t,e,n)};function dr(t,e){const n=kt[t],r=mt[t];let i=n+e;i<0&&(i=0),i>=r&&(i=r-1),kt[t]=i;for(let a=0;a<r;a++){const s=document.getElementById(`${t}-${a+1}`);s&&(s.style.display="none")}const o=document.getElementById(`${t}-${i+1}`);o&&(o.style.display="flex"),Qe(t,i),Ze(t,i,r)}function Qe(t,e){const n=document.getElementById(`${t}-${e+1}`);if(!n)return;n.querySelectorAll(".dot").forEach((i,o)=>{o===e?i.classList.add("active"):i.classList.remove("active")})}function Ze(t,e,n){const r=document.getElementById(`${t}-${e+1}`);if(!r)return;const i=r.querySelector(".prev-btn"),o=r.querySelector(".next-btn");i&&(i.disabled=e===0),o&&(o.disabled=e===n-1)}const ht={nodes:[{id:"covid19",label:"Covid-19",acronym:"CoV",type:"disease",chunk:"A",context:"Covid-19 is a respiratory disease that can cause severe illness in some patients."},{id:"remdesivir",label:"Remdesivir",acronym:"Rem",type:"drug",chunk:"A",context:"Remdesivir is an antiviral drug used to treat Covid-19 and has shown some effectiveness."},{id:"respiratory",label:"Respiratory diseases",acronym:"Res",type:"disease",chunk:"A",context:"Respiratory diseases like Covid-19 may require antiviral and anti-inflammatory treatments."},{id:"glucocorticoids",label:"Glucocorticoids",acronym:"Glu",type:"hormone",chunk:"B",context:"Glucocorticoids are hormones that help reduce inflammation in the body."},{id:"dexamethasone",label:"Dexamethasone",acronym:"Dex",type:"drug",chunk:"B",context:"Dexamethasone is a pharmacologic substance classified as a glucocorticoid."}],links:[{source:"remdesivir",target:"covid19",label:"treats"},{source:"covid19",target:"respiratory",label:"is a"},{source:"dexamethasone",target:"glucocorticoids",label:"is a"}]},pe={searchPath:[{level:"level2",nodeId:"meta3",reason:"Medical Therapeutics covers treatment approaches"},{level:"level1",nodeId:"meta1",reason:"Infectious Disease Management includes Covid-19 treatments"},{level:"chunks",nodeId:"chunkA",reason:"Infectious Disease & Treatment chunk contains Covid-19 treatment info"}],answerRefinement:{chunkLevel:{answer:"Specific infectious disease treatments include antiviral medications like Remdesivir and targeted respiratory disease management.",graphNodes:["covid19","remdesivir","respiratory"],graphLinks:[{source:"remdesivir",target:"covid19",label:"treats"},{source:"covid19",target:"respiratory",label:"is a"}]},level1:{answer:"Infectious disease management involves antiviral therapy, respiratory medicine, and specialized clinical care approaches.",metaTags:["DISEASE_CATEGORY","TREATMENT_APPROACH","CLINICAL_FOCUS"]},level2:{answer:"Clinical therapeutics for disease management encompass comprehensive treatment strategies, patient care optimization, and evidence-based healthcare approaches.",metaTags:["MEDICAL_DOMAIN","PATIENT_CARE","HEALTHCARE_FOCUS"]}}},Z={chunks:{chunkA:{id:"chunkA",name:"Infectious Disease & Treatment",color:"#ff6b6b",tags:[{type:"DISEASE",value:"Covid-19",description:"Respiratory disease causing severe illness"},{type:"MEDICATION",value:"Remdesivir",description:"Antiviral drug for Covid-19 treatment"},{type:"SYMPTOM",value:"Respiratory distress",description:"Difficulty breathing and lung complications"},{type:"TREATMENT_TYPE",value:"Antiviral therapy",description:"Medication targeting viral replication"},{type:"BODY_SYSTEM",value:"Respiratory system",description:"Lungs and breathing apparatus"}]},chunkB:{id:"chunkB",name:"Hormones & Pharmacology",color:"#4ecdc4",tags:[{type:"MEDICATION_CLASS",value:"Glucocorticoids",description:"Hormones that reduce inflammation"},{type:"MEDICATION",value:"Dexamethasone",description:"Specific glucocorticoid medication"},{type:"BODY_FUNCTION",value:"Inflammation regulation",description:"Control of inflammatory responses"},{type:"PHARMACOLOGY",value:"Anti-inflammatory",description:"Medication mechanism of action"},{type:"HORMONE_TYPE",value:"Steroid hormones",description:"Class of hormone medications"}]}},metaTags:{level1:[{id:"meta1",name:"Infectious Disease Management",color:"#ff6b6b",children:["chunkA"],tags:[{type:"DISEASE_CATEGORY",value:"Infectious diseases",description:"Diseases caused by pathogens"},{type:"TREATMENT_APPROACH",value:"Antiviral therapy",description:"Targeted treatment for viral infections"},{type:"CLINICAL_FOCUS",value:"Respiratory medicine",description:"Specialized care for breathing disorders"}]},{id:"meta2",name:"Endocrinology & Pharmacology",color:"#4ecdc4",children:["chunkB"],tags:[{type:"MEDICAL_SPECIALTY",value:"Endocrinology",description:"Study of hormones and metabolism"},{type:"DRUG_CLASS",value:"Steroid medications",description:"Hormone-based pharmaceutical agents"},{type:"THERAPEUTIC_GOAL",value:"Inflammation control",description:"Managing inflammatory responses"}]}],level2:[{id:"meta3",name:"Medical Therapeutics",color:"#45b7d1",children:["meta1","meta2"],tags:[{type:"MEDICAL_DOMAIN",value:"Clinical therapeutics",description:"Application of medical treatments"},{type:"PATIENT_CARE",value:"Disease management",description:"Comprehensive treatment approaches"},{type:"HEALTHCARE_FOCUS",value:"Treatment optimization",description:"Improving patient outcomes"}]}]}},pr={disease:"#1976d2",drug:"#d32f2f",hormone:"#7b1fa2"};let et={playing:!1,paused:!1,currentStep:0,nodeTransitions:[],linkTransitions:[]};function Je(){console.log("setupEntityGraphControls called");const t=P("#entity-graph-controls");t.html(""),t.append("button").attr("id","entity-play-btn").text("Play").style("padding","8px 18px").style("background","#1976d2").style("color","white").style("border","none").style("border-radius","4px").style("font-size","14px").style("cursor","pointer").on("click",()=>{et.playing?et.paused&&resumeEntityExtraction():ze()}),t.append("button").attr("id","entity-pause-btn").text("Pause").style("padding","8px 18px").style("background","#888").style("color","white").style("border","none").style("border-radius","4px").style("font-size","14px").style("cursor","pointer").on("click",()=>{pauseEntityExtraction()}),t.append("button").attr("id","entity-restart-btn").text("Restart").style("padding","8px 18px").style("background","#43a047").style("color","white").style("border","none").style("border-radius","4px").style("font-size","14px").style("cursor","pointer").on("click",()=>{ze()})}function ze(){console.log("animateEntityExtraction called"),et.playing=!0,et.paused=!1,et.currentStep=0,et.nodeTransitions=[],et.linkTransitions=[];const t=P("#entity-graph-svg");console.log("SVG selection:",t.node()),t.selectAll("*").remove();const e=+t.attr("width"),n=+t.attr("height");console.log("SVG width/height:",e,n);const r={covid19:{x:120,y:120},remdesivir:{x:240,y:80},respiratory:{x:240,y:180},glucocorticoids:{x:120,y:300},dexamethasone:{x:240,y:320}},i=-80,o=t.selectAll(".entity-node").data(ht.nodes).enter().append("g").attr("class","entity-node").attr("transform",c=>`translate(${i},${r[c.id].y})`).attr("opacity",0).on("mouseover",function(c,l){wl(c,l)}).on("mouseout",function(){z()});o.append("circle").attr("r",26).attr("fill",c=>pr[c.type]||"#aaa").attr("stroke","#333").attr("stroke-width",2),o.append("text").attr("text-anchor","middle").attr("y",6).attr("fill","#fff").attr("font-size",18).attr("font-weight",700).text(c=>c.acronym);let a=0;o.each(function(c,l){const p=P(this).transition().delay(l*300).duration(700).attr("transform",`translate(${r[c.id].x},${r[c.id].y})`).attr("opacity",1).on("end",()=>{a++,a===ht.nodes.length&&s()});et.nodeTransitions.push(p)});function s(){t.selectAll(".link").data(ht.links).enter().append("line").attr("class","link").attr("x1",u=>r[u.source].x).attr("y1",u=>r[u.source].y).attr("x2",u=>r[u.target].x).attr("y2",u=>r[u.target].y).attr("stroke","#888").attr("stroke-width",2).attr("opacity",0).on("mouseover",function(u,p){le(u,p)}).on("mouseout",function(){z()}).transition().delay((u,p)=>800+p*200).duration(400).attr("opacity",1),t.selectAll(".link-label").data(ht.links).enter().append("text").attr("class","link-label").attr("x",u=>(r[u.source].x+r[u.target].x)/2).attr("y",u=>(r[u.source].y+r[u.target].y)/2-10).attr("text-anchor","middle").attr("fill","#555").attr("font-size",13).attr("font-weight",500).attr("opacity",0).text(u=>u.label).on("mouseover",function(u,p){le(u,p)}).on("mouseout",function(){z()}).transition().delay((u,p)=>1e3+p*200).duration(400).attr("opacity",1)}}function wl(t,e){z(),P("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0,0,0,0.92)").style("color","white").style("padding","10px 16px").style("border-radius","6px").style("font-size","14px").style("pointer-events","none").style("z-index",1e3).style("box-shadow","0 2px 8px rgba(0,0,0,0.3)").html(`
    <div><strong>Name:</strong> ${e.label}</div>
    <div><strong>Type:</strong> ${e.type.charAt(0).toUpperCase()+e.type.slice(1)}</div>
    <div style="margin-top: 6px;"><strong>Context:</strong><br/><span style="font-style: italic; color: #b3e5fc;">"${e.context}"</span></div>
  `).style("left",t.pageX+12+"px").style("top",t.pageY-10+"px")}function le(t,e,n,r){z(),P("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0,0,0,0.92)").style("color","white").style("padding","10px 16px").style("border-radius","6px").style("font-size","14px").style("pointer-events","none").style("z-index",1e3).style("box-shadow","0 2px 8px rgba(0,0,0,0.3)").html(`
    <div><strong>Relationship:</strong> ${e.label||""}</div>
    <div><strong>Source:</strong> ${n&&(n.name||n.label)||""}</div>
    <div><strong>Target:</strong> ${r&&(r.name||r.label)||""}</div>
  `).style("left",t.pageX+12+"px").style("top",t.pageY-10+"px")}function z(){bt(".tooltip").remove()}const _l=dr;window.changeSlide=function(t,e){console.log("window.changeSlide called",t,e,kt[t]),_l(t,e),t==="graph-construction"&&kt[t]===2&&Je()};const we=document.getElementById("graph-construction-3");we&&new MutationObserver(()=>{window.getComputedStyle(we).display!=="none"&&Je()}).observe(we,{attributes:!0,attributeFilter:["style"]});function kl(){document.querySelectorAll(".dot").forEach(t=>{t.addEventListener("click",function(){const e=parseInt(this.getAttribute("data-slide")),n=this.closest(".slide-section").id.replace(/-[0-9]+$/,"");kt[n]=e;const r=mt[n];for(let o=0;o<r;o++){const a=document.getElementById(`${n}-${o+1}`);a&&(a.style.display="none")}const i=document.getElementById(`${n}-${e+1}`);i&&(i.style.display="flex"),Qe(n,e),Ze(n,e,r)})}),Object.keys(mt).forEach(t=>{const e=mt[t];for(let n=0;n<e;n++){const r=document.getElementById(`${t}-${n+1}`);r&&(r.style.display=n===0?"flex":"none")}})}const Al=()=>{hl(),yl(),ml();const t=new MutationObserver(n=>{n.forEach(r=>{if(r.type==="attributes"&&r.attributeName==="style"){const i=r.target;i.id==="graph-construction-3"&&i.style.display!=="none"&&(console.log("Graph construction slide 3 is now visible, setting up controls"),Je(),ze())}})}),e=document.getElementById("graph-construction-3");e&&t.observe(e,{attributes:!0})};fr.setup({step:".step",offset:.5,debug:!1}).onStepEnter(t=>{const{element:e,index:n,direction:r}=t;bt(".step").classed("active",!1),P(e).classed("active",!0),e.id==="overall-graph-structure"&&je(),e.id==="graph-tagging"&&(Tl(),Nl()),e.id==="question-answering"&&(Ot(),Ll()),console.log(`Step ${n} entered`)}).onStepExit(t=>{const{element:e,index:n,direction:r}=t;console.log(`Step ${n} exited`)});document.addEventListener("DOMContentLoaded",()=>{Al(),kl(),window.addEventListener("resize",fr.resize)});const dt={layers:[{id:"ehr",label:"EHR Data",color:"#ff7043",y:120,patients:[{id:"Patient-001",nodes:[{id:"p1",label:"Patient-001",type:"patient",age:58,sex:"F"},{id:"p1-diabetes",label:"Type 2 Diabetes",type:"diagnosis"},{id:"p1-hypertension",label:"Hypertension",type:"diagnosis"},{id:"p1-metformin",label:"Metformin",type:"medication"},{id:"p1-lisinopril",label:"Lisinopril",type:"medication"},{id:"p1-hba1c",label:"HbA1c: 8.2%",type:"lab"},{id:"p1-creatinine",label:"Creatinine: 1.1",type:"lab"},{id:"p1-admission",label:"Admission 2024-05-01",type:"encounter",date:"2024-05-01"}],links:[{source:"p1",target:"p1-diabetes",label:"has diagnosis"},{source:"p1",target:"p1-hypertension",label:"has diagnosis"},{source:"p1",target:"p1-metformin",label:"prescribed"},{source:"p1",target:"p1-lisinopril",label:"prescribed"},{source:"p1",target:"p1-hba1c",label:"lab result"},{source:"p1",target:"p1-creatinine",label:"lab result"},{source:"p1",target:"p1-admission",label:"had encounter"}]},{id:"Patient-002",nodes:[{id:"p2",label:"Patient-002",type:"patient",age:67,sex:"M"},{id:"p2-chf",label:"Congestive Heart Failure",type:"diagnosis"},{id:"p2-afib",label:"Atrial Fibrillation",type:"diagnosis"},{id:"p2-warfarin",label:"Warfarin",type:"medication"},{id:"p2-furosemide",label:"Furosemide",type:"medication"},{id:"p2-inr",label:"INR: 2.5",type:"lab"},{id:"p2-bnp",label:"BNP: 350",type:"lab"},{id:"p2-followup",label:"Follow-up 2024-06-10",type:"encounter",date:"2024-06-10"}],links:[{source:"p2",target:"p2-chf",label:"has diagnosis"},{source:"p2",target:"p2-afib",label:"has diagnosis"},{source:"p2",target:"p2-warfarin",label:"prescribed"},{source:"p2",target:"p2-furosemide",label:"prescribed"},{source:"p2",target:"p2-inr",label:"lab result"},{source:"p2",target:"p2-bnp",label:"lab result"},{source:"p2",target:"p2-followup",label:"had encounter"}]},{id:"Patient-003",nodes:[{id:"p3",label:"Patient-003",type:"patient",age:45,sex:"F"},{id:"p3-asthma",label:"Asthma",type:"diagnosis"},{id:"p3-obesity",label:"Obesity",type:"diagnosis"},{id:"p3-albuterol",label:"Albuterol",type:"medication"},{id:"p3-fluticasone",label:"Fluticasone",type:"medication"},{id:"p3-fev1",label:"FEV1: 1.8L",type:"lab"},{id:"p3-bmi",label:"BMI: 34",type:"lab"},{id:"p3-er",label:"ER Visit 2024-04-15",type:"encounter",date:"2024-04-15"}],links:[{source:"p3",target:"p3-asthma",label:"has diagnosis"},{source:"p3",target:"p3-obesity",label:"has diagnosis"},{source:"p3",target:"p3-albuterol",label:"prescribed"},{source:"p3",target:"p3-fluticasone",label:"prescribed"},{source:"p3",target:"p3-fev1",label:"lab result"},{source:"p3",target:"p3-bmi",label:"lab result"},{source:"p3",target:"p3-er",label:"had encounter"}]}]},{id:"papers",label:"Med Books & Papers",color:"#42a5f5",y:300,papers:[{id:"Paper-001",nodes:[{id:"paper1",label:"Metformin for Type 2 Diabetes",type:"paper",context:"A randomized controlled trial evaluating the efficacy of metformin in glycemic control for adults with type 2 diabetes."},{id:"paper1-diabetes",label:"Type 2 Diabetes",type:"topic",context:"Primary disease focus of the study."},{id:"paper1-metformin",label:"Metformin",type:"intervention",context:"Drug intervention studied."},{id:"paper1-hba1c",label:"HbA1c",type:"outcome",context:"Primary outcome measure: change in HbA1c."}],links:[{source:"paper1",target:"paper1-diabetes",label:"studies"},{source:"paper1",target:"paper1-metformin",label:"intervention"},{source:"paper1",target:"paper1-hba1c",label:"measures"}]},{id:"Paper-002",nodes:[{id:"paper2",label:"Heart Failure Management Guidelines",type:"guideline",context:"2022 clinical practice guideline for the diagnosis and management of heart failure."},{id:"paper2-chf",label:"Congestive Heart Failure",type:"topic",context:"Main disease addressed."},{id:"paper2-bnp",label:"BNP",type:"biomarker",context:"BNP as a diagnostic and prognostic biomarker."},{id:"paper2-furosemide",label:"Furosemide",type:"treatment",context:"Loop diuretic recommended for symptom relief."}],links:[{source:"paper2",target:"paper2-chf",label:"addresses"},{source:"paper2",target:"paper2-bnp",label:"discusses"},{source:"paper2",target:"paper2-furosemide",label:"recommends"}]},{id:"Paper-003",nodes:[{id:"paper3",label:"Asthma and Obesity: A Review",type:"review",context:"A systematic review of the relationship between obesity and asthma severity in adults."},{id:"paper3-asthma",label:"Asthma",type:"topic",context:"Primary disease focus."},{id:"paper3-obesity",label:"Obesity",type:"risk factor",context:"Risk factor for increased asthma severity."},{id:"paper3-fev1",label:"FEV1",type:"outcome",context:"Lung function outcome."}],links:[{source:"paper3",target:"paper3-asthma",label:"reviews"},{source:"paper3",target:"paper3-obesity",label:"analyzes"},{source:"paper3",target:"paper3-fev1",label:"measures"}]}]},{id:"dict",label:"Med Vocabularies",color:"#66bb6a",y:480,entries:[{id:"umls-metformin",name:"Metformin",type:"drug",context:"A biguanide oral antihyperglycemic agent used for the management of type 2 diabetes mellitus."},{id:"umls-bnp",name:"BNP",type:"biomarker",context:"B-type natriuretic peptide, a cardiac neurohormone used as a biomarker for heart failure."},{id:"umls-fev1",name:"FEV1",type:"measurement",context:"Forced expiratory volume in 1 second, a measure of lung function."},{id:"umls-furosemide",name:"Furosemide",type:"drug",context:"A loop diuretic used to treat fluid build-up due to heart failure, liver scarring, or kidney disease."},{id:"umls-hba1c",name:"HbA1c",type:"lab",context:"Glycated hemoglobin, a measure of average blood glucose over the past 2-3 months."},{id:"umls-asthma",name:"Asthma",type:"disease",context:"A chronic inflammatory disease of the airways characterized by variable and recurring symptoms."},{id:"umls-obesity",name:"Obesity",type:"disease",context:"A condition characterized by excessive body fat that increases the risk of health problems."}]}],edges:[{source:"p1-diabetes",target:"paper1-diabetes"},{source:"p1-metformin",target:"paper1-metformin"},{source:"p1-hba1c",target:"paper1-hba1c"},{source:"p2-chf",target:"paper2-chf"},{source:"p2-bnp",target:"paper2-bnp"},{source:"p2-furosemide",target:"paper2-furosemide"},{source:"p3-asthma",target:"paper3-asthma"},{source:"p3-obesity",target:"paper3-obesity"},{source:"p3-fev1",target:"paper3-fev1"},{source:"paper1-metformin",target:"umls-metformin"},{source:"paper1-hba1c",target:"umls-hba1c"},{source:"paper2-bnp",target:"umls-bnp"},{source:"paper2-furosemide",target:"umls-furosemide"},{source:"paper3-fev1",target:"umls-fev1"},{source:"paper3-asthma",target:"umls-asthma"},{source:"paper3-obesity",target:"umls-obesity"}]};function je(){const t=P("#overall-graph-svg");t.selectAll("*").remove(),dt.layers.forEach((s,c)=>{t.append("rect").attr("x",60).attr("y",s.y-60).attr("width",680).attr("height",120).attr("rx",28).attr("fill",s.color).attr("fill-opacity",.13).attr("stroke",s.color).attr("stroke-width",2).attr("class","layer-plane").attr("cursor","pointer").on("mouseover",function(){t.selectAll(".layer-plane").attr("fill-opacity",(l,u)=>u===c?.18:.05).attr("stroke-opacity",(l,u)=>u===c?1:.15),t.selectAll(".layer-group").attr("opacity",(l,u)=>u===c?1:.18),t.selectAll(".layer-label").attr("opacity",(l,u)=>u===c?1:.18)}).on("mouseout",function(){t.selectAll(".layer-plane").attr("fill-opacity",.13).attr("stroke-opacity",1),t.selectAll(".layer-group").attr("opacity",1),t.selectAll(".layer-label").attr("opacity",1)}).on("click",()=>Ml(s.id)),t.append("text").attr("x",400).attr("y",s.y-80).attr("text-anchor","middle").attr("font-size",22).attr("font-weight",700).attr("fill",s.color).attr("class","layer-label").text(s.label).attr("pointer-events","none")});const e=dt.layers[0],n=t.append("g").attr("class","layer-group");e.patients.forEach((s,c)=>{const l=180+c*220,u=28,p=10;s.nodes.forEach((f,d)=>{const x=d/s.nodes.length*2*Math.PI,h=l+Math.cos(x)*u,y=e.y+Math.sin(x)*u;n.append("circle").attr("cx",h).attr("cy",y).attr("r",p).attr("fill",e.color).attr("fill-opacity",.85).attr("stroke","#333").attr("stroke-width",1.5).attr("cursor","pointer").on("mouseover",v=>xt(v,f)).on("mouseout",z)}),s.links.forEach(f=>{const d=s.nodes.find(h=>h.id===f.source),x=s.nodes.find(h=>h.id===f.target);if(d&&x){const h=s.nodes.indexOf(d),y=s.nodes.indexOf(x),v=h/s.nodes.length*2*Math.PI,m=y/s.nodes.length*2*Math.PI,b=l+Math.cos(v)*u,g=e.y+Math.sin(v)*u,_=l+Math.cos(m)*u,A=e.y+Math.sin(m)*u;n.insert("line",":first-child").attr("x1",b).attr("y1",g).attr("x2",_).attr("y2",A).attr("stroke","#888").attr("stroke-width",1).attr("stroke-dasharray","2 2").attr("opacity",.5)}})});const r=dt.layers[1],i=t.append("g").attr("class","layer-group");r.papers.forEach((s,c)=>{const l=180+c*220,u=28,p=10;s.nodes.forEach((f,d)=>{const x=d/s.nodes.length*2*Math.PI,h=l+Math.cos(x)*u,y=r.y+Math.sin(x)*u;i.append("circle").attr("cx",h).attr("cy",y).attr("r",p).attr("fill",r.color).attr("fill-opacity",.85).attr("stroke","#333").attr("stroke-width",1.5).attr("cursor","pointer").on("mouseover",v=>xt(v,f)).on("mouseout",z)}),s.links.forEach(f=>{const d=s.nodes.find(h=>h.id===f.source),x=s.nodes.find(h=>h.id===f.target);if(d&&x){const h=s.nodes.indexOf(d),y=s.nodes.indexOf(x),v=h/s.nodes.length*2*Math.PI,m=y/s.nodes.length*2*Math.PI,b=l+Math.cos(v)*u,g=r.y+Math.sin(v)*u,_=l+Math.cos(m)*u,A=r.y+Math.sin(m)*u;i.insert("line",":first-child").attr("x1",b).attr("y1",g).attr("x2",_).attr("y2",A).attr("stroke","#888").attr("stroke-width",1).attr("stroke-dasharray","2 2").attr("opacity",.5)}})});const o=dt.layers[2],a=t.append("g").attr("class","layer-group");o.entries.forEach((s,c)=>{const l=120+c*90,u=o.y;a.append("circle").attr("cx",l).attr("cy",u).attr("r",10).attr("fill",o.color).attr("fill-opacity",.85).attr("stroke","#333").attr("stroke-width",1.5).attr("cursor","pointer").on("mouseover",p=>xt(p,s)).on("mouseout",z)}),dt.edges.forEach(s=>{let c,l,u,p;e.patients.forEach((f,d)=>{const x=180+d*220;f.nodes.forEach((h,y)=>{if(h.id===s.source){const v=y/f.nodes.length*2*Math.PI;c=x+Math.cos(v)*28,l=e.y+Math.sin(v)*28}})}),r.papers.forEach((f,d)=>{const x=180+d*220;f.nodes.forEach((h,y)=>{if(h.id===s.target){const v=y/f.nodes.length*2*Math.PI;u=x+Math.cos(v)*28,p=r.y+Math.sin(v)*28}if(h.id===s.source){const v=y/f.nodes.length*2*Math.PI;c=x+Math.cos(v)*28,l=r.y+Math.sin(v)*28}})}),o.entries.forEach((f,d)=>{const x=120+d*90,h=o.y;f.id===s.target&&(u=x,p=h),f.id===s.source&&(c=x,l=h)}),c!==void 0&&l!==void 0&&u!==void 0&&p!==void 0&&t.insert("line",":first-child").attr("x1",c).attr("y1",l).attr("x2",u).attr("y2",p).attr("stroke","#1976d2").attr("stroke-width",1.5).attr("stroke-dasharray","4 3")}),document.getElementById("overall-graph-back").style.display="none"}function Ml(t){El(t),document.getElementById("overall-graph-back").style.display="block",document.getElementById("overall-graph-back").onclick=function(){je(),document.getElementById("overall-graph-back").style.display="none"}}function El(t){const e=P("#overall-graph-svg");e.selectAll("*").remove();const n=dt.layers.find(r=>r.id===t);n&&(e.append("rect").attr("x",60).attr("y",180).attr("width",680).attr("height",240).attr("rx",38).attr("fill",n.color).attr("fill-opacity",.18).attr("stroke",n.color).attr("stroke-width",2),e.append("text").attr("x",400).attr("y",170).attr("text-anchor","middle").attr("font-size",28).attr("font-weight",700).attr("fill",n.color).text(n.label),t==="ehr"?n.patients.forEach((r,i)=>{const o=220+i*220,a=48,s=16;r.nodes.forEach((c,l)=>{const u=l/r.nodes.length*2*Math.PI,p=o+Math.cos(u)*a,f=300+Math.sin(u)*a;e.append("circle").attr("cx",p).attr("cy",f).attr("r",s).attr("fill",n.color).attr("fill-opacity",.92).attr("stroke","#333").attr("stroke-width",2).attr("cursor","pointer").on("mouseover",d=>xt(d,c)).on("mouseout",z),e.append("text").attr("x",p).attr("y",f+6).attr("text-anchor","middle").attr("font-size",14).attr("font-weight",700).attr("fill","#fff").text(J(c)).attr("pointer-events","none")}),r.links.forEach(c=>{const l=r.nodes.find(p=>p.id===c.source),u=r.nodes.find(p=>p.id===c.target);if(l&&u){const p=r.nodes.indexOf(l),f=r.nodes.indexOf(u),d=p/r.nodes.length*2*Math.PI,x=f/r.nodes.length*2*Math.PI,h=o+Math.cos(d)*a,y=300+Math.sin(d)*a,v=o+Math.cos(x)*a,m=300+Math.sin(x)*a;e.append("line").attr("x1",h).attr("y1",y).attr("x2",v).attr("y2",m).attr("stroke","#888").attr("stroke-width",2).attr("stroke-dasharray","3 2").on("mouseover",b=>le(b,c,l,u)).on("mouseout",z)}})}):t==="papers"?n.papers.forEach((r,i)=>{const o=220+i*220,a=48,s=16;r.nodes.forEach((c,l)=>{const u=l/r.nodes.length*2*Math.PI,p=o+Math.cos(u)*a,f=300+Math.sin(u)*a;e.append("circle").attr("cx",p).attr("cy",f).attr("r",s).attr("fill",n.color).attr("fill-opacity",.92).attr("stroke","#333").attr("stroke-width",2).attr("cursor","pointer").on("mouseover",d=>xt(d,c)).on("mouseout",z),e.append("text").attr("x",p).attr("y",f+6).attr("text-anchor","middle").attr("font-size",14).attr("font-weight",700).attr("fill","#fff").text(J(c)).attr("pointer-events","none")}),r.links.forEach(c=>{const l=r.nodes.find(p=>p.id===c.source),u=r.nodes.find(p=>p.id===c.target);if(l&&u){const p=r.nodes.indexOf(l),f=r.nodes.indexOf(u),d=p/r.nodes.length*2*Math.PI,x=f/r.nodes.length*2*Math.PI,h=o+Math.cos(d)*a,y=300+Math.sin(d)*a,v=o+Math.cos(x)*a,m=300+Math.sin(x)*a;e.append("line").attr("x1",h).attr("y1",y).attr("x2",v).attr("y2",m).attr("stroke","#888").attr("stroke-width",2).attr("stroke-dasharray","3 2").on("mouseover",b=>le(b,c,l,u)).on("mouseout",z)}})}):t==="dict"&&n.entries.forEach((r,i)=>{const o=180+i*90,a=300;e.append("circle").attr("cx",o).attr("cy",a).attr("r",14).attr("fill",n.color).attr("fill-opacity",.92).attr("stroke","#333").attr("stroke-width",2).attr("cursor","pointer").on("mouseover",s=>xt(s,r)).on("mouseout",z),e.append("text").attr("x",o).attr("y",a+6).attr("text-anchor","middle").attr("font-size",14).attr("font-weight",700).attr("fill","#fff").text(J(r)).attr("pointer-events","none")}))}function xt(t,e){z();let n=e.name||e.label,r=e.type,i=e.context||e.meta&&e.meta.definition||"";P("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0,0,0,0.92)").style("color","white").style("padding","10px 16px").style("border-radius","6px").style("font-size","14px").style("pointer-events","none").style("z-index",1e3).style("box-shadow","0 2px 8px rgba(0,0,0,0.3)").html(`
    <div><strong>Name:</strong> ${n}</div>
    <div><strong>Type:</strong> ${r}</div>
    <div style="margin-top: 6px;"><strong>Context:</strong><br/><span style="font-style: italic; color: #b3e5fc;">${i}</span></div>
  `).style("left",t.pageX+12+"px").style("top",t.pageY-10+"px")}function Sl(t){document.querySelectorAll(".step").forEach(n=>n.style.display="none");const e=document.getElementById(t);e&&(e.style.display="",je())}function J(t){if(t.acronym)return t.acronym;const e=t.name||t.label||"",n=e.split(/\s+/);return n.length===1?e.slice(0,4).toUpperCase():n.map(r=>r[0]).join("").toUpperCase().slice(0,4)}function Tl(){const t=P("#tag-graph-svg");t.selectAll("*").remove();const e=420,n=520,r={top:20,right:20,bottom:20,left:20},i=e-r.left-r.right,o=n-r.top-r.bottom,a=t.append("g").attr("transform",`translate(${r.left}, ${r.top})`);a.append("text").attr("x",i/2).attr("y",0).attr("text-anchor","middle").style("font-size","16px").style("font-weight","600").style("fill","#333").text("Graph Tagging Hierarchy"),Cl(a,i,o)}function $l(t,e){z();const n=P("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0,0,0,0.92)").style("color","white").style("padding","12px 16px").style("border-radius","6px").style("font-size","13px").style("pointer-events","none").style("z-index",1e3).style("box-shadow","0 2px 8px rgba(0,0,0,0.3)").style("max-width","300px");let r=`<div style="margin-bottom: 8px;"><strong>${e.name}</strong></div>`;r+='<div style="margin-bottom: 6px;"><strong>Extracted Tags:</strong></div>',e.tags.forEach(i=>{r+='<div style="margin: 2px 0; padding: 2px 0; border-bottom: 1px solid #444;">',r+=`<span style="color: #90caf9;">${i.type}:</span> ${i.value}`,r+=`<div style="font-size: 11px; color: #b3e5fc; font-style: italic; margin-top: 2px;">${i.description}</div>`,r+="</div>"}),n.html(r).style("left",t.pageX+12+"px").style("top",t.pageY-10+"px")}function Rn(t,e){z();const n=P("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0,0,0,0.92)").style("color","white").style("padding","12px 16px").style("border-radius","6px").style("font-size","13px").style("pointer-events","none").style("z-index",1e3).style("box-shadow","0 2px 8px rgba(0,0,0,0.3)").style("max-width","300px");let r=`<div style="margin-bottom: 8px;"><strong>${e.name}</strong></div>`;r+=`<div style="margin-bottom: 4px; color: #90caf9;">Meta Tags (${e.tags.length})</div>`,e.tags.forEach(i=>{r+='<div style="margin: 2px 0; padding: 2px 0; border-bottom: 1px solid #444;">',r+=`<span style="color: #90caf9;">${i.type}:</span> ${i.value}`,r+=`<div style="font-size: 11px; color: #b3e5fc; font-style: italic; margin-top: 2px;">${i.description}</div>`,r+="</div>"}),r+=`<div style="margin-top: 8px; color: #f48fb1;">Children: ${e.children.join(", ")}</div>`,n.html(r).style("left",t.pageX+12+"px").style("top",t.pageY-10+"px")}function Cl(t,e,n){const a=Z.metaTags.level2[0],s=e/2,c=60;t.append("circle").attr("cx",s).attr("cy",c).attr("r",20).attr("fill",a.color).attr("fill-opacity",.8).attr("stroke","#333").attr("stroke-width",2).attr("cursor","pointer").on("mouseover",p=>Rn(p,a)).on("mouseout",z),t.append("text").attr("x",s).attr("y",c+5).attr("text-anchor","middle").style("font-size","12px").style("font-weight","600").style("fill","#fff").text("MT").attr("pointer-events","none"),Z.metaTags.level1.forEach((p,f)=>{const d=e/2+(f===0?-60:60),x=c+80;t.append("circle").attr("cx",d).attr("cy",x).attr("r",20).attr("fill",p.color).attr("fill-opacity",.8).attr("stroke","#333").attr("stroke-width",2).attr("cursor","pointer").on("mouseover",h=>Rn(h,p)).on("mouseout",z),t.append("text").attr("x",d).attr("y",x+5).attr("text-anchor","middle").style("font-size","12px").style("font-weight","600").style("fill","#fff").text(J(p)).attr("pointer-events","none"),t.append("line").attr("x1",s).attr("y1",c+20).attr("x2",d).attr("y2",x-20).attr("stroke","#666").attr("stroke-width",2).attr("stroke-dasharray","3 2")}),Object.values(Z.chunks).forEach((p,f)=>{const d=e/2+(f===0?-60:60),x=c+2*80;t.append("circle").attr("cx",d).attr("cy",x).attr("r",20).attr("fill",p.color).attr("fill-opacity",.8).attr("stroke","#333").attr("stroke-width",2).attr("cursor","pointer").on("mouseover",v=>$l(v,p)).on("mouseout",z),t.append("text").attr("x",d).attr("y",x+5).attr("text-anchor","middle").style("font-size","12px").style("font-weight","600").style("fill","#fff").text(J(p)).attr("pointer-events","none");const h=e/2+(f===0?-120/2:120/2),y=c+80;t.append("line").attr("x1",h).attr("y1",y+20).attr("x2",d).attr("y2",x-20).attr("stroke","#666").attr("stroke-width",2).attr("stroke-dasharray","3 2")}),t.append("text").attr("x",10).attr("y",c).style("font-size","12px").style("font-weight","600").style("fill","#666").text("Level 2:"),t.append("text").attr("x",10).attr("y",c+80).style("font-size","12px").style("font-weight","600").style("fill","#666").text("Level 1:"),t.append("text").attr("x",10).attr("y",c+2*80).style("font-size","12px").style("font-weight","600").style("fill","#666").text("Chunks:"),t.append("text").attr("x",e/2).attr("y",n-10).attr("text-anchor","middle").style("font-size","12px").style("fill","#666").text("Hover over nodes to see extracted tags")}function Nl(){P("#tag-graph-controls").html("")}let O={searchPath:[],animationPhase:"search",currentRefinementLevel:null};function Ot(){const t=P("#qa-graph-svg");t.selectAll("*").remove();const e=420,n=520,r={top:20,right:20,bottom:20,left:20},i=e-r.left-r.right,o=n-r.top-r.bottom;t.append("defs").append("marker").attr("id","arrowhead").attr("viewBox","0 -5 10 10").attr("refX",8).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("fill","#666");const a=t.append("g").attr("transform",`translate(${r.left}, ${r.top})`);let s="Tag Tree Search Process";O.animationPhase==="graph"?s="Chunk Graph Analysis":O.animationPhase==="refinement"&&(s="Answer Refinement Process"),a.append("text").attr("x",i/2).attr("y",0).attr("text-anchor","middle").style("font-size","16px").style("font-weight","600").style("fill","#333").text(s),O.animationPhase==="search"?Rl(a,i,o):O.animationPhase==="graph"?Pl(a,i,o):O.animationPhase==="refinement"&&Il(a,i,o)}function Rl(t,e,n){const a=Z.metaTags.level2[0],s=e/2,c=60,l=O.searchPath.some(d=>d.level==="level2"&&d.nodeId===a.id);t.append("circle").attr("cx",s).attr("cy",c).attr("r",20).attr("fill",l?"#ffc107":a.color).attr("fill-opacity",.8).attr("stroke",l?"#ff6f00":"#333").attr("stroke-width",l?3:2).attr("cursor","pointer").on("mouseover",d=>_e(d,a,l)).on("mouseout",z),t.append("text").attr("x",s).attr("y",c+5).attr("text-anchor","middle").style("font-size","12px").style("font-weight","600").style("fill","#fff").text("MT").attr("pointer-events","none");const u=Z.metaTags.level1;u.forEach((d,x)=>{const h=e/2+(x===0?-60:60),y=c+80,v=O.searchPath.some(g=>g.level==="level1"&&g.nodeId===d.id);t.append("circle").attr("cx",h).attr("cy",y).attr("r",20).attr("fill",v?"#ffc107":d.color).attr("fill-opacity",.8).attr("stroke",v?"#ff6f00":"#333").attr("stroke-width",v?3:2).attr("cursor","pointer").on("mouseover",g=>_e(g,d,v)).on("mouseout",z),t.append("text").attr("x",h).attr("y",y+5).attr("text-anchor","middle").style("font-size","12px").style("font-weight","600").style("fill","#fff").text(J(d)).attr("pointer-events","none");const m=l&&v?"#ff6f00":"#666",b=l&&v?3:2;t.append("line").attr("x1",s).attr("y1",c+20).attr("x2",h).attr("y2",y-20).attr("stroke",m).attr("stroke-width",b).attr("stroke-dasharray","3 2")}),Object.values(Z.chunks).forEach((d,x)=>{const h=e/2+(x===0?-60:60),y=c+2*80,v=O.searchPath.some(E=>E.level==="chunks"&&E.nodeId===d.id);t.append("circle").attr("cx",h).attr("cy",y).attr("r",20).attr("fill",v?"#ffc107":d.color).attr("fill-opacity",.8).attr("stroke",v?"#ff6f00":"#333").attr("stroke-width",v?3:2).attr("cursor","pointer").on("mouseover",E=>_e(E,d,v)).on("mouseout",z),t.append("text").attr("x",h).attr("y",y+5).attr("text-anchor","middle").style("font-size","12px").style("font-weight","600").style("fill","#fff").text(J(d)).attr("pointer-events","none");const m=u[x],b=e/2+(x===0?-120/2:120/2),g=c+80,_=O.searchPath.some(E=>E.level==="level1"&&E.nodeId===m.id),A=_&&v?"#ff6f00":"#666",S=_&&v?3:2;t.append("line").attr("x1",b).attr("y1",g+20).attr("x2",h).attr("y2",y-20).attr("stroke",A).attr("stroke-width",S).attr("stroke-dasharray","3 2")}),O.searchPath.some(d=>d.level==="chunks")&&(t.append("text").attr("x",e/2).attr("y",n-30).attr("text-anchor","middle").style("font-size","12px").style("font-weight","600").style("fill","#28a745").text("✓ Found relevant chunk: Infectious Disease & Treatment"),t.append("text").attr("x",e/2).attr("y",n-15).attr("text-anchor","middle").style("font-size","11px").style("fill","#666").text("Contains: Remdesivir, Antiviral therapy"))}function Pl(t,e,n){const r=ht.nodes.filter(u=>u.chunk==="A"),i=ht.links.filter(u=>r.some(p=>p.id===u.source)&&r.some(p=>p.id===u.target)),o={covid19:{x:e/2,y:n/2-60},remdesivir:{x:e/2-80,y:n/2},respiratory:{x:e/2+80,y:n/2}},a=25;i.forEach(u=>{const p=o[u.source],f=o[u.target];t.append("line").attr("x1",p.x).attr("y1",p.y).attr("x2",f.x).attr("y2",f.y).attr("stroke","#666").attr("stroke-width",3).attr("marker-end","url(#arrowhead)");const d=(p.x+f.x)/2,x=(p.y+f.y)/2;t.append("text").attr("x",d).attr("y",x-5).attr("text-anchor","middle").style("font-size","10px").style("fill","#666").style("font-weight","600").text(u.label)}),r.forEach(u=>{const p=o[u.id],f=pr[u.type]||"#666";t.append("circle").attr("cx",p.x).attr("cy",p.y).attr("r",a).attr("fill",f).attr("fill-opacity",.8).attr("stroke","#333").attr("stroke-width",2).attr("cursor","pointer").on("mouseover",d=>zl(d,u)).on("mouseout",z),t.append("text").attr("x",p.x).attr("y",p.y+5).attr("text-anchor","middle").style("font-size","11px").style("font-weight","600").style("fill","#fff").text(u.acronym).attr("pointer-events","none")}),t.append("text").attr("x",e/2).attr("y",n-60).attr("text-anchor","middle").style("font-size","12px").style("font-weight","600").style("fill","#28a745").text("Generated Answer:");const c=((u,p,f=14)=>{const d=u.split(" "),x=[];let h=d[0];for(let y=1;y<d.length;y++){const v=d[y],m=h+" "+v;m.length*6.5>p-20?(x.push(h),h=v):h=m}return x.push(h),x})(pe.answerRefinement.chunkLevel.answer,e-40),l=14;c.forEach((u,p)=>{t.append("text").attr("x",e/2).attr("y",n-40+p*l).attr("text-anchor","middle").style("font-size","11px").style("fill","#333").text(u)})}function Il(t,e,n){const a=Z.metaTags.level2[0],s=e/2,c=60,l=O.currentRefinementLevel==="level2";if(t.append("circle").attr("cx",s).attr("cy",c).attr("r",20).attr("fill",l?"#ff9800":a.color).attr("fill-opacity",.8).attr("stroke",l?"#e65100":"#333").attr("stroke-width",l?3:2).attr("cursor","pointer").on("mouseover",f=>ke(f,a,"level2")).on("mouseout",z),t.append("text").attr("x",s).attr("y",c+5).attr("text-anchor","middle").style("font-size","12px").style("font-weight","600").style("fill","#fff").text("MT").attr("pointer-events","none"),Z.metaTags.level1.forEach((f,d)=>{const x=e/2+(d===0?-60:60),h=c+80,y=O.currentRefinementLevel==="level1";t.append("circle").attr("cx",x).attr("cy",h).attr("r",20).attr("fill",y?"#ff9800":f.color).attr("fill-opacity",.8).attr("stroke",y?"#e65100":"#333").attr("stroke-width",y?3:2).attr("cursor","pointer").on("mouseover",v=>ke(v,f,"level1")).on("mouseout",z),t.append("text").attr("x",x).attr("y",h+5).attr("text-anchor","middle").style("font-size","12px").style("font-weight","600").style("fill","#fff").text(J(f)).attr("pointer-events","none"),t.append("line").attr("x1",s).attr("y1",c+20).attr("x2",x).attr("y2",h-20).attr("stroke","#666").attr("stroke-width",2).attr("stroke-dasharray","3 2")}),Object.values(Z.chunks).forEach((f,d)=>{const x=e/2+(d===0?-60:60),h=c+2*80,y=O.currentRefinementLevel==="chunkLevel";t.append("circle").attr("cx",x).attr("cy",h).attr("r",20).attr("fill",y?"#ff9800":f.color).attr("fill-opacity",.8).attr("stroke",y?"#e65100":"#333").attr("stroke-width",y?3:2).attr("cursor","pointer").on("mouseover",b=>ke(b,f,"chunkLevel")).on("mouseout",z),t.append("text").attr("x",x).attr("y",h+5).attr("text-anchor","middle").style("font-size","12px").style("font-weight","600").style("fill","#fff").text(J(f)).attr("pointer-events","none");const v=e/2+(d===0?-120/2:120/2),m=c+80;t.append("line").attr("x1",v).attr("y1",m+20).attr("x2",x).attr("y2",h-20).attr("stroke","#666").attr("stroke-width",2).attr("stroke-dasharray","3 2")}),O.currentRefinementLevel){const f=pe.answerRefinement[O.currentRefinementLevel];t.append("text").attr("x",e/2).attr("y",n-60).attr("text-anchor","middle").style("font-size","12px").style("font-weight","600").style("fill","#ff9800").text("Refined Answer:");const x=((y,v,m=14)=>{const b=y.split(" "),g=[];let _=b[0];for(let A=1;A<b.length;A++){const S=b[A],E=_+" "+S;E.length*6.5>v-20?(g.push(_),_=S):_=E}return g.push(_),g})(f.answer,e-40),h=14;x.length*h,x.forEach((y,v)=>{t.append("text").attr("x",e/2).attr("y",n-40+v*h).attr("text-anchor","middle").style("font-size","11px").style("fill","#333").text(y)})}}function _e(t,e,n){z();const r=P("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0,0,0,0.92)").style("color","white").style("padding","12px 16px").style("border-radius","6px").style("font-size","13px").style("pointer-events","none").style("z-index",1e3).style("box-shadow","0 2px 8px rgba(0,0,0,0.3)").style("max-width","300px");let i=`<div style="margin-bottom: 8px;"><strong>${e.name||e.label}</strong></div>`;if(n){const o=O.searchPath.find(a=>a.level==="chunks"&&a.nodeId===e.id||a.level==="level1"&&a.nodeId===e.id||a.level==="level2"&&a.nodeId===e.id);i+='<div style="margin-bottom: 6px; color: #ffc107;"><strong>✓ Search Match</strong></div>',i+=`<div style="margin-bottom: 4px; color: #90caf9;">Reason: ${o.reason}</div>`}e.tags&&(i+=`<div style="margin-bottom: 4px; color: #90caf9;">Tags (${e.tags.length})</div>`,e.tags.forEach(o=>{i+='<div style="margin: 2px 0; padding: 2px 0; border-bottom: 1px solid #444;">',i+=`<span style="color: #90caf9;">${o.type}:</span> ${o.value}`,i+=`<div style="font-size: 11px; color: #b3e5fc; font-style: italic; margin-top: 2px;">${o.description}</div>`,i+="</div>"})),r.html(i).style("left",t.pageX+12+"px").style("top",t.pageY-10+"px")}function zl(t,e){z();const n=P("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0,0,0,0.92)").style("color","white").style("padding","12px 16px").style("border-radius","6px").style("font-size","13px").style("pointer-events","none").style("z-index",1e3).style("box-shadow","0 2px 8px rgba(0,0,0,0.3)").style("max-width","300px");let r=`<div style="margin-bottom: 8px;"><strong>${e.label}</strong></div>`;r+=`<div style="margin-bottom: 4px; color: #90caf9;">Type: ${e.type}</div>`,r+=`<div style="margin-bottom: 4px; color: #90caf9;">Chunk: ${e.chunk}</div>`,r+=`<div style="margin-bottom: 4px; color: #b3e5fc; font-style: italic;">${e.context}</div>`,n.html(r).style("left",t.pageX+12+"px").style("top",t.pageY-10+"px")}function ke(t,e,n){z();const r=P("body").append("div").attr("class","tooltip").style("position","absolute").style("background","rgba(0,0,0,0.92)").style("color","white").style("padding","12px 16px").style("border-radius","6px").style("font-size","13px").style("pointer-events","none").style("z-index",1e3).style("box-shadow","0 2px 8px rgba(0,0,0,0.3)").style("max-width","300px");let i=`<div style="margin-bottom: 8px;"><strong>${e.name||e.label}</strong></div>`;i+='<div style="margin-bottom: 6px; color: #ff9800;"><strong>Answer Refinement Level</strong></div>';const o=pe.answerRefinement[n];o&&(i+='<div style="margin-bottom: 4px; color: #90caf9;">Refined Answer:</div>',i+=`<div style="margin-bottom: 4px; color: #b3e5fc; font-style: italic;">${o.answer}</div>`,o.metaTags&&(i+='<div style="margin-bottom: 4px; color: #90caf9;">Meta Tags Used:</div>',o.metaTags.forEach(a=>{i+=`<div style="margin: 2px 0; color: #b3e5fc;">• ${a}</div>`}))),r.html(i).style("left",t.pageX+12+"px").style("top",t.pageY-10+"px")}function Ll(){const t=P("#qa-controls");t.html(""),t.append("button").text("Start Search").style("padding","8px 16px").style("background","#007bff").style("color","white").style("border","none").style("border-radius","4px").style("font-size","14px").style("cursor","pointer").on("click",()=>{Ol()}),t.append("button").text("Reset").style("padding","8px 16px").style("background","#6c757d").style("color","white").style("border","none").style("border-radius","4px").style("font-size","14px").style("cursor","pointer").style("margin-left","8px").on("click",()=>{O.searchPath=[],O.animationPhase="search",O.currentRefinementLevel=null,Ot()})}function Ol(){O.searchPath=[],O.animationPhase="search",O.currentRefinementLevel=null;const t=pe.searchPath;let e=0;const n=()=>{if(e<t.length){const r=t[e];O.searchPath.push(r),Ot(),e++,setTimeout(n,1500)}else setTimeout(()=>{O.animationPhase="graph",Ot(),setTimeout(()=>{O.animationPhase="refinement",Dl()},3e3)},1e3)};n()}function Dl(){const t=["chunkLevel","level1","level2"];let e=0;const n=()=>{e<t.length&&(O.currentRefinementLevel=t[e],Ot(),e++,setTimeout(n,2e3))};n()}
